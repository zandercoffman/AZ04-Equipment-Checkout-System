<!DOCTYPE html>


<!-- ========================================
     Equipment Checkout System – Main HTML
     Author: Zander Coffman
     Purpose: Web interface for managing 
              items, students, and rentals 
              in an equipment checkout workflow.
     Dependencies: TailwindCSS, Bootstrap, 
                   jQuery, JsBarcode, jsPDF
========================================= -->


<html>
<!-- ========== HEAD SECTION ==========
     Loads CSS frameworks, fonts, and libraries
     - Tailwind for utility styling
     - Bootstrap for UI components
     - Google Fonts (Inter)
     - jQuery for DOM manipulation
     - JsBarcode for generating barcodes
     - jsPDF + autotable for PDF creation
==================================== -->

<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Equipment Checkout System</title>

  <!-- ========== SCRIPT IMPORTS ==========
     - canvg: Converts SVG to Canvas for PDF use
     - React & ReactDOM: (Possible future UI use)
     - Tailwind config customization
     - jsPDF & autotable for PDF generation
======================================= -->

  <!--Download Tailwind CSS (CSS Framework)-->
  <script src="https://cdn.tailwindcss.com"></script>

  <!--Custom Component Library for CSS Tailwind-->
  <link href="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.css" rel="stylesheet" />

  <!--JS Barcode library for generating pdfs with barcodes represeting items or students-->
  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.0/dist/JsBarcode.all.min.js"></script>

  <!--Download google fonts-->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap"
    rel="stylesheet">

  <!--Download JQuery-->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!--Download Boostrap-->
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

  <!-- Importing a .xls to .json converter-->
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
  <!-- ChatGPT said: 
  
  Available Function: Class List via Admin Reports (XLS)

If you're using Synergy TeacherVUE, you can get a class-level list in Excel format:

Navigate to Admin > Admin Reports.

Select the report "Class List (Elementary) With Student Usernames – Teacher".

Click the XLS button to download the list as an Excel file 
Eugene School District 4J
.

This provides details like student names, usernames, and possibly guardian permissions—it’s ideal for mail-merge tasks but is not in CSV format, nor is it designed to capture all your students across multiple classes.
  -->



  <!--
  Old libraries
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/notyf@3.1.0/dist/notyf.min.css">
  <script src="https://cdn.jsdelivr.net/npm/notyf@3.1.0/dist/notyf.min.js"></script>-->

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap');

    /* Apply to your site */
    body {
      font-family: "Plus Jakarta Sans", "Inter", "Segoe UI", "Roboto", "Helvetica Neue", sans-serif;
    }

    .table-style {
      font-size: 14px !important;
    }

    .tab-btn {
      padding: 0.5rem 1rem;
      background: #ccc;
      border-radius: 0.5rem;
      font-weight: bold;
      cursor: pointer;
      border: none;
    }

    .tab-btn.active {
      background: #2196f3;
      color: white;
    }

    .fixed-container {
      height: min-content;
      margin-top: 10px;
      padding: 10px;
      z-index: 100;
    }

    /* Width */
    ::-webkit-scrollbar {
      width: 8px;
      /* Reduced width for a more subtle appearance */
    }

    /* Track */
    ::-webkit-scrollbar-track {
      background: #f0f0f0;
      /* Light gray background for a calming feel */
      border-radius: 5px;
    }

    /* Handle */
    ::-webkit-scrollbar-thumb {
      background: #c0c0c0;
      /* Soft gray for the thumb */
      border-radius: 5px;
    }

    /* Handle on hover */
    ::-webkit-scrollbar-thumb:hover {
      background: #a0a0a0;
      /* Slightly darker gray for hover effect */
    }

    .switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 25px;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 25px;
      /* Larger border-radius */
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 21px;
      width: 21px;
      left: 2px;
      bottom: 2px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    input:checked+.slider {
      background-color: #2196F3;
    }

    input:checked+.slider:before {
      transform: translateX(25px);
    }

    .scanning-mode-selection-button {
      font-size: 30px;
      flex: 1 1 0;
      border: 1px solid black;
      border-radius: 10px;


    }

    #scanning-mode-selection-div {
      margin: 20px;

    }

    #scanning-mode-selection-div[selection="create"]>div>button#scanning-mode-selection-create-rental {
      background-color: lightgray;
    }

    #scanning-mode-selection-div[selection="return"]>div>button#scanning-mode-selection-return-rental {
      background-color: lightgray;
    }

    #generatingReportsIndicator {
      display: flex;
      flex-direction: column;
      border: 1px solid black;
      border-radius: 5px;

      position: fixed;
      top: 30px;
      right: 30px;

      background-color: white;

      min-width: 200px;
      min-height: 50px;
      z-index: 1000;
    }

    .create-button {
      color: white;
    }

    main {
      margin-left: 5%;
      margin-right: 5%;
      padding-left: 1rem;
      padding-right: 1rem;
      min-width: fit-content;
    }

    @media (max-width: 1250px) {
      main {
        margin-left: auto !important;
        margin-right: auto !important;
      }
    }

    .highlighted {
      background-color: yellow !important;
      color: black !important;
    }

    .bulk-input-table-textarea {
      min-width: fit-content;
      width: 100%;
      resize: none;
      overflow: hidden;
    }

    #loading {
      position: fixed;
      z-index: 99999;
      visibility: hidden;
      left: 0;
      top: 0;

      width: 100vw;
      height: 100vh;

      background-color: rgba(179, 179, 179, 0.85);


      display: flex;
      justify-content: center;
      align-items: center;



    }

    input[type="checkbox"] {
      transform: scale(2);
      background-color: #D3D3D3;
      border-radius: 20px;
      transition: all 200ms;
      shadow: 20px;
    }

    input[type="checkbox"]:hover {
      background-color: #A9A9A9;
    }

    #popup-modal table td,
    #popup-modal table th {
      border: 1px solid gray;
    }
  </style>

</head>

<body class="bg-gray-100">

  <!-- ========== HIDDEN UTILITY ELEMENTS ==========
     These elements are not visible but used in JS:
     - #barcodeCanvas: Temporary canvas for barcode generation
============================================== -->
  <canvas width="1000px" height="1000px" id="barcodeCanvas" style="display: none"></canvas>

  <!-- ========== POPUP: SCANNING MODE ==========
     UI for scanning or typing IDs to create/return rentals.
     Features:
       - Mode selection (Create Rentals / Return Rentals)
       - Manual input box
       - Instructions + results display
============================================ -->
  <div id="scanning-mode-popup"
    class="hidden fixed top-0 left-0 z-50 w-full h-full flex justify-center bg-black bg-opacity-50 overflow-y-scroll">
    <div id="scanning-mode-popup-div"
      class="bg-white rounded-xl shadow-lg p-6 w-full flex flex-column justify-between items-center "
      style="width: 95vw; min-height: 95vh; height: fit-content; position: relative; margin-top: 20px; margin-bottom: 20px;">
      <div class="flex flex-col md:flex-row justify-between items-center" style="height: 100%;">

        <div id="scanMode1" class="w-full md:w-1/2">
          <!-- Title -->
          <h3 class="text-2xl font-semibold mb-4" id="scanning-mode-popup-title" style="font-size: 2.5em;">Rental Mode
          </h3>

          <!--Section for selecting whether to create rentals or return them -->
          <div id="scanning-mode-selection-div" class="items-center flex flex-column" selection="create">
            <h2 style="font-size: 2em;">Select a scanning mode</h2>
            <div class="flex flex-row" style="gap: 20px; margin: 20px;">
              <button id="scanning-mode-selection-create-rental" class="scanning-mode-selection-button p-2"  onclick="scanningModeSelectMode('create')">Create Rentals</button>
              <button id="scanning-mode-selection-return-rental" class="scanning-mode-selection-button p-2"  onclick="scanningModeSelectMode('return')">Return Rentals</button>
            </div>
          </div>

          <!-- Section for typing or scanning in IDs -->
          <div class="items-center flex flex-column">
            <h2 style="font-size: 2em; margin-bottom: 13px;">Type Here</h2>
            <input type="text" id="scanning-mode-input-box" style="font-size: 30px; flex: 1 1 0; border: 2px solid black; border-radius: 10px; max-height: 2em; text-align: center;"></input>
            <div class="flex flex-row gap-2">
              <button id="submit-scanning-mode-popup" class="mt-4 flex flex-row gap-1 bg-green-500 text-white px-3 py-2 rounded-md hover:bg-red-600" onclick="submitScanningMode()">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-save"><path d="M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z"/><path d="M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7"/><path d="M7 3v4a1 1 0 0 0 1 1h7"/></svg>
              <span>Submit</span>
            </button>

            </div>
          </div>


          <!--Close button-->
          <div class="flex flex-row gap-4">
            <div class="flex flex-row gap-2">
              <button id="close-scanning-mode-popup" onclick="closeScanningMode()" class="mt-4 flex flex-row gap-1 bg-red-500 text-white px-3 py-2 rounded-md hover:bg-red-600">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
              <span>Close</span>
            </button>
            </div>
          </div>
        </div>

        <div id="scanmodeside2" class="w-full md:w-1/2">

          <div id="accordion-collapse" data-accordion="collapse">
            <h2 id="accordion-collapse-heading-1">
              <button type="button" class="flex items-center justify-between w-full p-5 font-medium rtl:text-right text-gray-500 border border-gray-200 focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-800 dark:border-gray-700 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 gap-3" data-accordion-target="#accordion-collapse-body-3" aria-expanded="false" aria-controls="accordion-collapse-body-3">
                <span>How do I create a rental?</span>
                <svg data-accordion-icon class="w-3 h-3 rotate-180 shrink-0" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 10 6">
                  <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5 5 1 1 5"/>
                </svg>
              </button>
            </h2>
            <div id="accordion-collapse-body-1" aria-labelledby="accordion-collapse-heading-1">
              <div class="p-5 border border-t-0 border-gray-200 dark:border-gray-700">
                <h2 id="title">Creating a Rental</h2>
                <ul style="list-style-type: disc; margin-left: 20px;">
                  <li>First, choose either <span class="font-semibold">Create Rental</span> or
                    <span class="font-semibold">Return Rentals</span>
                  </li>
                  <li>Ask the student to show their physical school ID at checkout.</li>
                  <li>Scan either the student’s ID or the product’s barcode first.</li>
                  <li>The system will guide you — <em>wait</em> until it tells you you can scan into the textbox.</li>
                  <li>After scanning, enter the expected return date in this format: <code>MM-DD-YYYY</code>.</li>
                  <li>Once the date is entered, the rental is created automatically.</li>
                </ul>


                <p class="hint">Tip: If you get stuck, try scanning the other item first (ID vs product) and follow the
                  prompts on the screen.</p>
              </div>
            </div>


            <!--Instructions and results for scanning codes are shown here-->
            <h1 id="scanning-mode-message" style="margin: 40px; display: none; font-size: 2em; font-weight: bold;"></h1>


          </div>

        </div>
      </div>
    </div>
  </div>

  <!-- ========== POPUP: REPORTS VIEW ==========
     UI for generating PDF reports:
       - Item popularity
       - Lost item report
       - Timespan selection
============================================ -->
  <div id="reports-view-popup"
    class="hidden fixed top-0 left-0 z-50 w-full h-full flex justify-center bg-black overflow-y-scroll bg-opacity-50">
    <div class="bg-white rounded-xl shadow-lg p-6 w-full flex flex-column justify-between items-center"
      style="width: 95vw; min-height: 95vh; height: fit-content; text-align: center; margin-top: 20px; margin-bottom: 20px;">
      <h3 class="text-2xl font-semibold mb-4" id="scanning-mode-popup-title" style="font-size: 2em;">Reports View</h3>


      <!--Section for chosing what data to include in reports-->
      <div class="report-view-row items-center flex flex-column">
        <div class="report-view-row-header items-center flex flex-column">
          <h3 style="font-size: 2em; margin: 20px;">Timespan</h3>
          <p style="max-width: 30%; text-align: center;">Select the start and end dates the report should be based on.
            Click a calender icon to select a date, or click on mm/dd/yyyy to type a date.</p>
        </div>
        <div class="report-view-button-div">
          <p style="font-size: 1.5em;">Start</p>
          <input id="report-view-timespanStart-input" type="date">

          <p style="font-size: 1.5em;">End</p>
          <input id="report-view-timespanEnd-input" type="date">
        </div>
      </div>

      <!--Section for chosing which report types to download-->
      <div id="report-download-buttons" class="flex flex-column justify-between; items-center;" style="gap: 10px;">
        <h3 style="font-size: 2em; margin: 20px;">Select Report Type</h3>
        <div class="report-view-row">
          <div class="report-view-row-header">
            <h3>Item Popularity/Usage Report</h3>
          </div>
          <div class="report-view-button-div">
            <button onclick="generateAndDownloadReport('itemPopularityUsageReport', document.getElementById('report-view-timespanStart-input').value, document.getElementById('report-view-timespanEnd-input').value)" class="report-view-button inline-flex flex flex-row gap-2 text-white items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/></svg>
              <span>Generate and Download</span>
            </button>
          </div>
        </div>

        <div class="report-view-row">
          <div class="report-view-row-header">
            <h3>Lost Item Report</h3>
          </div>
          <div class="report-view-button-div">
            <button onclick="generateAndDownloadReport('lostItemReport', document.getElementById('report-view-timespanStart-input').value, document.getElementById('report-view-timespanEnd-input').value)" class="report-view-button inline-flex flex flex-row gap-2 text-white items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/></svg>
              <span>Generate and Download</span>
            </button>
          </div>
        </div>
      </div>


      <!--Close popup button-->
      <div class="w-full flex flex-row justify-between items-center">
        <div class="flex flex-row gap-4 items-center" style="width: 100%;">
          <div class="flex flex-row gap-2 items-center" style="width: 100%;">
            <button id="close-report-view-popup" onclick="closeReportsView()" style="margin-left: auto; margin-right: auto;" class="mt-4 flex flex-row gap-1 bg-red-500 text-white px-3 py-2 rounded-md hover:bg-red-600 items-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                <span>Close</span>
              </button>
          </div>
        </div>
      </div>
    </div>
  </div>
  </div>



  <!-- ========== POPUP: LOADING INDICATOR ==========
     Small floating panel showing currently generating reports
============================================ -->
  <div id="generatingReportsIndicator" style="visibility: hidden;">
    <!--HTML representing each report is added here using JS-->
  </div>


  <!-- ========== POPUP: ENTITY DETAILS ==========
     Shared modal for viewing/editing:
       - Item details
       - Rental details
       - Student details
       - Add new items/students
     Note: Only one section is visible at a time.
============================================ -->
  <div id="popup-modal"
    class="hidden fixed top-0 left-0 z-50 w-full h-full flex items-center justify-center bg-black bg-opacity-50 overflow-y-scroll">
    <div class="bg-white rounded-xl shadow-lg p-6 h-fit"
      style="width: 95vw; min-height: 95vh; position: absolute; left: 0vw; top: 0vw; margin-left: 2.5vw; margin-right: 2.5vw; margin-top: 2.5vh; margin-bottom: 2.5vh;">


      <!--Title shown in the popup, depending on which section is visible this title is updating using JS-->
      <h3 class="text-2xl font-semibold mb-4" id="popup-modal-title">CATAGORY Details</h3>



      <!-- Item details section here -->

      <div id="popup-item-details-content" class="space-y-2 w-full hidden"
        style="min-height: 66vh; height: fit-content;">
        <!-- Content will be populated here -->
        <table class="w-1/2 border-collapse bg-white overflow-y-scroll overflow-x-hidden max-h-[70vh] block pb-4">
          <thead class="bg-gray-50">
            <tr>
              <th class="py-2 px-4 font-medium text-left border-b w-1/3">Field</th>
              <th class="py-2 px-4 font-medium text-left border-b">Value</th>
            </tr>
          </thead>
          <tbody class="overflow-y-auto block h-full" id="popup-item-details-table">
            <tr class="border-b">
              <td class="py-2 px-4 font-medium bg-gray-50">Room/Area</td>
              <td class="py-2 px-4" contenteditable="true" id="item-details-roomArea"></td>
            </tr>
            <tr class="border-b">
              <td class="py-2 px-4 font-medium bg-gray-50">Item/Description</td>
              <td class="py-2 px-4" contenteditable="true" id="item-details-description"></td>
            </tr>
            <tr class="border-b">
              <td class="py-2 px-4 font-medium bg-gray-50">Make/Model</td>
              <td class="py-2 px-4" contenteditable="true" id="item-details-makeModel"></td>
            </tr>
            <tr class="border-b">
              <td class="py-2 px-4 font-medium bg-gray-50">Asset Tag Number</td>
              <td class="py-2 px-4" contenteditable="false" id="item-details-assetTag"></td>
            </tr>
            <tr class="border-b">
              <td class="py-2 px-4 font-medium bg-gray-50">Serial Number</td>
              <td class="py-2 px-4" contenteditable="true" id="item-details-serialNumber"></td>
            </tr>
            <tr class="border-b">
              <td class="py-2 px-4 font-medium bg-gray-50">Notes</td>
              <td class="py-2 px-4" contenteditable="true" id="item-details-notes"></td>
            </tr>
            <tr class="border-b">
              <td class="py-2 px-4 font-medium bg-gray-50">Status (In/Out/Repair)</td>
              <td class="py-2 px-4" contenteditable="false" id="item-details-status"></td>
            </tr>
            <tr>
              <td class="py-2 px-4 font-medium bg-gray-50">Rental ID</td>
              <td class="py-2 px-4" contenteditable="false" id="item-details-rentalID"></td>
            </tr>
            <tr>
              <td class="py-2 px-4 font-medium bg-gray-50">School</td>
              <td class="py-2 px-4" contenteditable="false" id="item-details-school"></td>
            </tr>
          </tbody>
        </table>
        <div class="w-1/2">
          To edit item info, click into the box you want to edit, type in a new value, then click 'Save Changes'. Note:
          You are unable to edit the rental status and rental ID directly, this must be done through 'Scanning Mode'.
        </div>
      </div>



      <!-- Rental details section here -->

      <div id="popup-rental-details-content" class="space-y-2 w-full hidden"
        style="min-height: 66vh; height: fit-content;">
        <!-- Content will be populated here -->
        <table class="w-1/2 border-collapse bg-white overflow-y-scroll overflow-x-hidden max-h-[70vh] block pb-4">
          <thead class="bg-gray-50">
            <tr>
              <th class="py-2 px-4 font-medium text-left border-b w-1/3">Field</th>
              <th class="py-2 px-4 font-medium text-left border-b">Value</th>
            </tr>
          </thead>
          <tbody class="overflow-y-auto block h-full" id="popup-rental-details-table">
            <tr class="border-b">
              <td class="py-2 px-4 font-medium bg-gray-50">Rental ID</td>
              <td class="py-2 px-4" contenteditable="true" id="rental-details-rentalID"></td>
            </tr>
            <tr class="border-b">
              <td class="py-2 px-4 font-medium bg-gray-50">Item ID</td>
              <td class="py-2 px-4" contenteditable="true" id="rental-details-itemID"></td>
            </tr>
            <tr class="border-b">
              <td class="py-2 px-4 font-medium bg-gray-50">Status</td>
              <td class="py-2 px-4" contenteditable="true" id="rental-details-status"></td>
            </tr>
            <tr class="border-b">
              <td class="py-2 px-4 font-medium bg-gray-50">Checked Out To</td>
              <td class="py-2 px-4" contenteditable="true" id="rental-details-checkedOutTo"></td>
            </tr>
            <tr class="border-b">
              <td class="py-2 px-4 font-medium bg-gray-50">Date Checked Out</td>
              <td class="py-2 px-4" contenteditable="true" id="rental-details-dateCheckedOut"></td>
            </tr>
            <tr class="border-b">
              <td class="py-2 px-4 font-medium bg-gray-50">Date Expected To Return</td>
              <td class="py-2 px-4" contenteditable="true" id="rental-details-dateExpectedReturned"></td>
            </tr>
            <tr class="border-b">
              <td class="py-2 px-4 font-medium bg-gray-50">Notes</td>
              <td class="py-2 px-4" contenteditable="true" id="rental-details-notes"></td>
            </tr>
          </tbody>
        </table>
        <div class="w-1/2">
          To edit rental info, click into the box you want to edit, type in a new value, then click 'Save Changes'.
          Note:
          You are unable to edit the rental status and rental ID directly, this must be done through 'Scanning Mode'.
        </div>
      </div>


      <!-- Student Details Area -->

      <div id="popup-student-details-content" class="space-y-2 w-full hidden"
        style="min-height: 66vh; height: fit-content;">
        <!-- Content will be populated here -->
        <table class="w-1/2 border-collapse bg-white overflow-y-scroll overflow-x-hidden max-h-[70vh] block pb-4">
          <thead class="bg-gray-50">
            <tr>
              <th class="py-2 px-4 font-medium text-left border-b w-1/3">Field</th>
              <th class="py-2 px-4 font-medium text-left border-b">Value</th>
            </tr>
          </thead>
          <tbody class="overflow-y-auto block h-full" id="popup-student-details-table">
            <tr class="border-b">
              <td class="py-2 px-4 font-medium bg-gray-50">ID</td>
              <td class="py-2 px-4" contenteditable="false" id="student-details-id"></td>
            </tr>
            <tr class="border-b hidden">
              <td class="py-2 px-4 font-medium bg-gray-50">Class Year</td>
              <td class="py-2 px-4" contenteditable="true" id="student-details-classYear"></td>
            </tr>
            <tr class="border-b">
              <td class="py-2 px-4 font-medium bg-gray-50">Period</td>
              <td class="py-2 px-4" contenteditable="true" id="student-details-period"></td>
            </tr>
            <tr class="border-b">
              <td class="py-2 px-4 font-medium bg-gray-50">Name</td>
              <td class="py-2 px-4" contenteditable="true" id="student-details-name"></td>
            </tr>
          </tbody>
        </table>
        <div class="w-1/2 h-full">
          To edit student info, click into the box you want to edit, type in a new value, then click 'Save Changes'.
        </div>
      </div>


      <!-- Add items View section here -->

      <div id="popup-add-items-content"
        class="space-y-4 hidden flex flex-col items-center overflow-x-hidden min-h-[66vh] bg-white rounded-xl shadow-lg p-6">

        <!-- How Many Items Section -->
        <div id="popup-add-items-content-howManyDiv" class="hidden flex flex-col items-center gap-4">
          <h3 class="text-2xl font-semibold text-gray-800 text-center">
            How many items would you like to add?
            <span class="text-gray-500 text-lg">(Max of 20)</span>
          </h3>
          <input type="number" min="1"
           id="popup-add-items-content-numberOfItemsToAddInput"
           class="border border-gray-300 rounded-lg px-4 py-2 text-lg w-32 text-center focus:ring-2 focus:ring-blue-400 focus:outline-none">
          <button id="popup-add-items-content-numberOfItemsToAddInputSubmit"
            onclick="updateAddItemsPopupRows()"
            class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg shadow-md transition">
      Submit
    </button>
        </div>

        <!-- Table -->
        <div class="w-full overflow-x-auto border border-gray-200 rounded-lg shadow-sm">
          <table class="table-auto w-full text-sm text-left border-collapse">
            <thead class="bg-gray-100 sticky top-0">
              <tr>
                <th class="py-3 px-4 font-medium border-b">Delete Row</th>
                <th class="py-3 px-4 font-medium border-b">Room/Area</th>
                <th class="py-3 px-4 font-medium border-b">Item Description</th>
                <th class="py-3 px-4 font-medium border-b">Make/Model</th>
                <th class="py-3 px-4 font-medium border-b" style="color: red !important;">Asset Tag Number *</th>
                <th class="py-3 px-4 font-medium border-b">Serial Number</th>
                <th class="py-3 px-4 font-medium border-b">
                  School <button onclick="setallschool()" style="
  padding: 4px 8px;
  font-size: 12px;
  border: none;
  border-radius: 6px;
  background-color: #3b82f6; /* Blue-500 */
  color: white;
  cursor: pointer;
">
  Set All School to First Value
</button>

                </th>
                <th class="py-3 px-4 font-medium border-b">Notes</th>
              </tr>
            </thead>
            <tbody id="popup-add-items-table" class="divide-y divide-gray-200">
              <!-- Rows dynamically inserted here -->
            </tbody>
          </table>
        </div>

        <!-- Add Row Button -->
        <button onclick="updateAddItemsPopupRows(1)"
          class="bg-green-500 hover:bg-green-600 p-3 rounded-full shadow-md transition text-white">
    <svg xmlns="http://www.w3.org/2000/svg" 
         width="28" height="28" viewBox="0 0 24 24" 
         fill="none" stroke="currentColor" stroke-width="2" 
         stroke-linecap="round" stroke-linejoin="round" 
         class="lucide lucide-plus">
      <path d="M5 12h14"/>
      <path d="M12 5v14"/>
    </svg>
  </button>

        <!-- Instructions -->
        <div class="w-3/4 bg-blue-50 p-4 rounded-lg text-sm text-gray-700 border border-blue-200">
          To add item info, click into the box you want to edit, type in a new value, then click
          <b>'Save Changes'</b>.<br>
    Note: You cannot edit the rental status or rental ID directly — this must be done through
          <b>'Scanning Mode'</b>.<br>
          <b class="text-red-500">An * means the item is required.</b>
        </div>
      </div>


      <!-- Add Students View section here -->

      <div id="popup-add-students-content" class="space-y-2 hidden items-center flex flex-col overflow-x-hidden h-fit"
        style="min-height: 66vh; height: fit-content;">

        <div class="flex flex-row gap-2 hidden">
          <div id="popup-add-students-content-howManyDiv" class="flex flex-col items-center w-full"
            style="margin: 30px; gap: 20px;">
            <h3 style="font-size: 2em;">How many students would you like to add? (Max of 20)</h3>
            <input type="number" min="1" id="popup-add-students-content-numberOfStudentsToAddInput" style="border: 1px solid gray;"></input>
            <button id="popup-add-students-content-numberOfStudentsToAddInputSubmit" onclick="updateAddStudentsPopupRows()" style="border: 1px solid gray;">Submit</button>
          </div>
        </div>
        <div class="w-full h-fit overflow-x-scroll">
          <table class=" border-collapse bg-white overflow-y-scroll block pb-4 w-fit"
            style="table-layout: fixed; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
            <thead class="bg-gray-50 max-w-24">
              <tr>
                <th class="py-2 px-4 font-medium text-left border-b">Delete Row</th>
                <th class="py-2 px-4 font-medium text-left border-b text-red-500">ID *</th>
                <th class="py-2 px-4 font-medium text-left border-b hidden">Class Year</th>
                <th class="py-2 px-4 font-medium text-left border-b">Period</th>
                <th class="py-2 px-4 font-medium text-left border-b">Name</th>
              </tr>
            </thead>
            <tbody class="overflow-y-auto h-full max-w-24" id="popup-add-students-table">



            </tbody>
          </table>
        </div>

        <button onclick="updateAddStudentsPopupRows(1)"><svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linaddItemsejoin="round" class="lucide lucide-plus"><path d="M5 12h14"/><path d="M12 5v14"/></svg></button>
        <div class="w-1/2 h-full">
          To add student info, click into the box you want to add info to, type in a new value, then click 'Save
          Changes'.
          <b class="text-red-500">An * means the item is required</b>
        </div>

      </div>


      <!-- Save and Close Buttons -->
      <div class="w-full flex flex-row justify-between">
        <div class="flex flex-row gap-4">
          <div class="flex flex-row gap-2">
            <button id="close-popup" class="mt-4 flex flex-row gap-1 bg-red-500 text-white px-3 py-2 rounded-md hover:bg-red-600">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
              <span>Close</span>
            </button>
          </div>

          <button class="absolute right-14 top-10" id="deleteButton" onclick="handleDelete()">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash-2"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
          </button>
        </div>
        <button id="save-and-close-popup" class="mt-4 flex flex-row gap-1 bg-green-500 text-white px-3 py-2 rounded-md hover:bg-red-600" onclick="saveModalEdits()">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-save"><path d="M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z"/><path d="M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7"/><path d="M7 3v4a1 1 0 0 0 1 1h7"/></svg>
          <span>Save Changes</span>
        </button>
      </div>


    </div>
  </div>


  <!-- These SVGS are for taking you back up to the page if say you're too down.-->

  <!--disabled for demo
  <section id="snackbar"
    class="fixed-container fixed mx-auto inset-0 flex items-center justify-center bg-white shadow-[0_8px_30px_rgb(0,0,0,0.12)] w-1/3 rounded-xl">
    Some text some message..
  </section>
  -->


  <main class="my-7 flex flex-col gap-3">

    <!-- ========== NAVIGATION & HEADER ==========
     Top header with system name and quick navigation buttons:
       - Items
       - Rentals
       - Students
       - Scanning Mode
       - Reports
============================================ -->

    <div id="taModeBool"
      class="hidden bg-blue-100 text-blue-800 font-medium px-4 py-2 rounded-lg shadow-sm w-fit text-sm flex items-center gap-2">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"
        stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round"
          d="M12 11V15M12 7H12.01M21 12A9 9 0 1 1 3 12a9 9 0 0 1 18 0Z" />
      </svg>
      Teacher Assistant / Self Checkout Mode is <span class="font-semibold">Active</span>
    </div>


    <header class="bg-slate-400 flex flex-row justify-between text-white rounded-lg shadow-md p-4 flex flex-row gap-2"
      id="header">
      <div class="flex flex-row gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
          class="lucide lucide-cable my-auto">
          <path d="M17 21v-2a1 1 0 0 1-1-1v-1a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v1a1 1 0 0 1-1 1" />
          <path d="M19 15V6.5a1 1 0 0 0-7 0v11a1 1 0 0 1-7 0V9" />
          <path d="M21 21v-2h-4" />
          <path d="M3 5h4V3" />
          <path d="M7 5a1 1 0 0 1 1 1v1a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a1 1 0 0 1 1-1V3" />
        </svg>
        <h1 class="text-3xl font-bold">Equipment Checkout System</h1>
        <p id="test" class="hidden"></p>
      </div>


    </header>

    <nav class="flex justify-between gap-10">
      <div class="flex flex-col md:flex-row gap-2 ">
        <button class="inline-flex shadow-md flex flex-row gap-2 text-white items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"
        onclick="showSection('items', event)">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-list-collapse"><path d="m3 10 2.5-2.5L3 5"/><path d="m3 19 2.5-2.5L3 14"/><path d="M10 6h11"/><path d="M10 12h11"/><path d="M10 18h11"/></svg>
          <span>Items</span>
      </button>
        <button class="inline-flex shadow-md flex flex-row gap-2 text-white items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"
      onclick="showSection('rentals', event)">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-align-start-vertical"><rect width="9" height="6" x="6" y="14" rx="2"/><rect width="16" height="6" x="6" y="4" rx="2"/><path d="M2 2v20"/></svg>
          <span>Rentals</span>
      </button>
        <button class="inline-flex shadow-md flex flex-row gap-2 text-white items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"
      onclick="showSection('people', event)">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-user"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="10" r="3"/><path d="M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662"/></svg>
          <span>Students</span>
      </button>
      </div>


      <div class="flex flex-col md:flex-row gap-2">
        <button class="inline-flex flex flex-row gap-2 shadow-md text-blue-600 items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-white text-primary-foreground hover:bg-primary/90 h-10 px-6 py-2"
      onclick="openScanningMode()" id="openScanningModeButton">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
          <path stroke-linecap="round" stroke-linejoin="round" d="M7.5 3.75H6A2.25 2.25 0 0 0 3.75 6v1.5M16.5 3.75H18A2.25 2.25 0 0 1 20.25 6v1.5m0 9V18A2.25 2.25 0 0 1 18 20.25h-1.5m-9 0H6A2.25 2.25 0 0 1 3.75 18v-1.5M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
        </svg>

          <span>Rental Mode</span>
      </button>
        <button class="hidden edit-button inline-flex flex flex-row gap-2 shadow-md text-blue-600 items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-white text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"
      onclick="openReportsView()">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/></svg>
        <span>Report Mode</span>
      </button>
      </div>
      <div class="flex flex-row gap-2 items-center">
        <!-- Google Docs -->
        <a href="https://docs.google.com/document/d/1JNXW4K7wZ9yyQPC1Z2jdrcEz_dyRexY8xHxE1vbAQls/edit?usp=sharing"
          target="_blank" rel="noopener noreferrer"
          class="flex flex-row items-center gap-2 px-3 py-1.5 text-xs bg-blue-50 text-blue-600 hover:bg-blue-100 shadow-md rounded-md transition-colors">
          <!-- Docs Icon -->
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
            stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-text">
            <path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z" />
            <path d="M14 2v4a2 2 0 0 0 2 2h4" />
            <path d="M10 9H8" />
            <path d="M16 13H8" />
            <path d="M16 17H8" />
          </svg>
          <span>Need Help?</span>
          <!-- External Link Icon -->
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
            stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-external-link">
            <path d="M15 3h6v6" />
            <path d="M10 14 21 3" />
            <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" />
          </svg>
        </a>

        <!-- Google Sheets -->
        <a href="#" target="_blank" rel="noopener noreferrer" id="GoogleSheetsLink"
          class="edit-button flex flex-row items-center gap-2 px-3 py-1.5 text-xs bg-green-50 shadow-md text-green-600 hover:bg-green-100 rounded-md transition-colors">
          <!-- Sheets Icon -->
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
            stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-spreadsheet">
            <path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z" />
            <path d="M14 2v4a2 2 0 0 0 2 2h4" />
            <path d="M8 13h2" />
            <path d="M14 13h2" />
            <path d="M8 17h2" />
            <path d="M14 17h2" />
          </svg>
          <span>Your Database</span>
          <!-- External Link Icon -->
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
            stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-external-link">
            <path d="M15 3h6v6" />
            <path d="M10 14 21 3" />
            <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" />
          </svg>
        </a>
      </div>
    </nav>


    <!-- ========== MAIN CONTENT: ITEM LIST ==========
     Displays all items in a table:
       - Basic info (location, name, model, status)
       - Selection checkboxes
       - Edit and "More" buttons
       - Action buttons (Add, Generate Barcodes, Delete)
============================================== -->
    <section class="items mt-4" id="items">
      <div class="w-full bg-white rounded-xl px-7 py-8 shadow-md" style="min-width: fit-content;">
        <table id="item-table" border="1" class="w-full table-style">
          <div class="flex flex-col md:flex-row gap-2 justify-between items-center">
            <h2 class="scroll-m-20 border-b pb-2 mb-6 text-3xl font-semibold tracking-tight first:mt-0">
              Item List
            </h2>
            <div class="flex flex-row gap-4 my-2">
              <button onclick="openAddItemsView()"
    class="edit-button create-button inline-flex items-center gap-2 justify-center rounded-2xl text-sm font-medium transition-colors 
           focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 
           disabled:opacity-50 disabled:pointer-events-none ring-offset-background 
           bg-primary text-primary-foreground hover:bg-primary/90 h-10 py-4 px-4"
    id="addStudentsButtons">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus">
        <path d="M5 12h14"/><path d="M12 5v14"/>
    </svg>
    Add Items
</button>

              <button onclick="generateItemBarcodes()"
    class="edit-button create-button inline-flex items-center gap-2 justify-center rounded-2xl text-sm font-medium transition-colors 
           focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 
           disabled:opacity-50 disabled:pointer-events-none ring-offset-background 
           bg-gray-800 text-white hover:bg-gray-700 h-10 py-4 px-4"
    id="generateItemBarcodesButton">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-barcode">
        <path d="M3 5v14"/><path d="M8 5v14"/><path d="M12 5v14"/><path d="M17 5v14"/><path d="M21 5v14"/>
    </svg>
    Generate Item Barcodes
</button>

              <button onclick="deleteSelectedItems()"
    class="create-button inline-flex items-center gap-2 justify-center rounded-2xl text-sm font-medium transition-colors 
           focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 
           disabled:opacity-50 disabled:pointer-events-none ring-offset-background 
           bg-red-600 text-white hover:bg-red-700 h-10 py-4 px-4 edit-button"
    id="deleteSelectedItemsButton">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash-2">
        <path d="M10 11v6"/><path d="M14 11v6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/><path d="M3 6h18"/><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
    </svg>
    Delete Selected Items
</button>


              <!--
            <div class="input-group mb-3">
              <input type="text" class="form-control" style="max-width: 300px;" placeholder="Search..." id="searchInput">
              <div class="input-group-append">
                <button class="btn btn-outline-secondary" type="button" id="searchButton">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search">
                    <circle cx="11" cy="11" r="8"/>
                    <path d="m21 21-4.3-4.3"/>
                  </svg>
                </button>
              </div>

            </div>
            -->
            </div>
          </div>
          <thead class="[&_tr]:border-b bg-gray-200 rounded-xl px-2">
            <tr class="border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-gray-100 "
              id="items-header">
              <th class="h-12 px-1 text-left align-middle font-medium [&:has([role=checkbox])]:pr-0"
                id="items-header-checkboxes">
                Select
              </th>
              <th class="h-12 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0"
                id="items-header-roomArea">
                Room
              </th>
              <th
                class="h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0"
                id="items-header-name">
                Name
              </th>
              <th
                class="h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0"
                id="items-header-model">
                Location
              </th>
              <th
                class="h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0"
                id="items-header-assetTagNumber">
                Asset Tag Number
              </th>
              <th
                class="h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0"
                id="items-header-status">
                Status
              </th>
              <th
                class="h-12 hidden px-4 edit-button text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0"
                id="items-header-rent">
                Rent
              </th>
              <th
                class="h-12 px-4 edit-button text-left edit-button align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0"
                id="items-header-more">
                More/Edit
              </th>
              <th
                class="hidden h-12 px-4 edit-button text-left edit-button align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0"
                id="items-header-edit">
                Edit
              </th>
            </tr>
          </thead>
          <tbody class="p-10"></tbody>

        </table>
      </div>

    </section>


    <!-- ========== MAIN CONTENT: RENTAL LIST ==========
     Displays outstanding rentals in a table:
       - Rental ID, Item ID, Status, Checked out to
       - "More" details button
       - Create Rental button
=============================================== -->
    <section class="people flex flex-col gap-2" id="rentals">

      <div class="taModeBool hidden w-full bg-white rounded-xl px-7 py-8 mb-2 shadow-md flex flex-row justify-between"
        style="min-width: fit-content;">
        <div class="flex flex-col gap-2 w-full md:w-2/3">
          <h2 class="scroll-m-20 border-b pb-2 text-3xl font-semibold tracking-tight first:mt-0">
            Making a Rental in Assistant Mode
          </h2>

          <h1 class="text-xl font-semibold text-blue-600">How to Make a Rental While in Assistant/Self Checkout Mode
          </h1>
          <p class="text-md text-gray-700">Even though editing is disabled in this mode, you can still rent items using
            the dedicated Rental Mode:</p>
          <ul class="list-disc pl-6 text-md text-gray-700 space-y-2">
            <li>Click the <span class="font-semibold text-pink-500">Rental Mode</span> button at the top of the page.
            </li>
            <li>This opens the rental interface, allowing students or assistants to select and check out items.</li>
            <li>You can search for items, fill out rental details, and submit the rental — all without editing system
              data.</li>
            <li class="font-bold text-lg">This keeps things safe while still allowing smooth checkout.</li>
          </ul>
        </div>

        <div class="ml-10 my-auto relative w-full md:w-1/3">
          <div class="bg-pink-100 text-pink-800 px-4 py-3 rounded-lg text-center text-sm font-medium shadow-inner">
            🔐 Rentals are still allowed in this mode — just press the <span class="font-semibold">Rental Mode</span>
            button above.
          </div>
        </div>
      </div>


      <div
        class="taModeBool edit-button w-full bg-white rounded-xl px-7 py-8 mb-2 shadow-md flex flex-row justify-between"
        style="min-width: fit-content;">
        <div class="flex flex-col gap-2 w-full md:w-2/3">
          <h2 class="scroll-m-20 border-b pb-2 text-3xl font-semibold tracking-tight first:mt-0">
            Teacher Assistant/Self Checkout Mode Tutorial
          </h2>

          <h1 class="text-xl font-semibold text-blue-600">How Teacher Assistant/Self Checkout Mode Works</h1>
          <p class="text-md text-gray-700">When you enable Teacher Assistant/Self Checkout Mode:</p>
          <ul class="list-disc pl-6 text-md text-gray-700 space-y-2">
            <li>Students and Teacher Assistants can <span class="font-bold">check out items</span> but cannot make any
              changes to the system.</li>
            <li>Editing features are temporarily disabled to ensure the system remains secure and data is not
              accidentally modified.</li>
            <li>This mode will put you in full screen in the rental view. Press
              <span class="font-bold">ESC (escape)</span> to get out of full-screen mode.
            </li>
            <li class="font-bold text-lg">You can regain editing features by reloading the page.</li>
          </ul>
        </div>

        <div class="ml-10 my-auto relative w-full md:w-1/3">
          <button id="enableTeacherAssistantMode" class="inline-flex items-center gap-2 justify-center rounded-2xl text-sm font-medium transition-colors
    focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-green-600 focus-visible:ring-offset-2
    bg-blue-600 text-white hover:bg-blue-700 h-10 py-4 px-4 cursor-pointer">

    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check-icon lucide-check"><path d="M20 6 9 17l-5-5"/></svg>
    Enable Teacher Assistant Mode
  </button>
        </div>

      </div>

      <div class="w-full bg-white rounded-xl px-7 py-8 shadow-md" style="min-width: fit-content;">
        <table id="rental-table" border="1" class="w-full">
          <div class="flex flex-row justify-between">
            <h2 class="scroll-m-20 border-b pb-2 text-3xl font-semibold tracking-tight first:mt-0">
              Outstanding Rental List
            </h2>
            <div class="flex flex-row gap-2">
              <a href="#" target="_blank" id="viewPastRentals" class="edit-button inline-flex items-center gap-2 justify-center rounded-2xl text-sm font-medium transition-colors 
          focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 
          disabled:opacity-50 pointer-events-auto ring-offset-background 
          bg-primary text-white hover:bg-primary/90 h-10 py-4 px-4">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor"
                  stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-history">
                  <path d="M3 3v5h5" />
                  <path d="M3.05 13a9 9 0 1 0 .5-7.5L3 8" />
                  <path d="M12 7v5l4 2" />
                </svg>
                See Past Rentals
              </a>

              <button onclick="openMakeRentalView()"
    class="create-button inline-flex items-center gap-2 justify-center rounded-2xl text-sm font-medium transition-colors 
           focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-green-600 focus-visible:ring-offset-2 
           disabled:opacity-50 disabled:pointer-events-none ring-offset-background 
           bg-green-600 text-white hover:bg-green-700 h-10 py-4 px-4"
    id="addStudentsButtons">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor" 
         stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus">
        <path d="M5 12h14"/><path d="M12 5v14"/>
    </svg>
    Add Items
</button>

            </div>
          </div>



          <thead class="[&_tr]:border-b">
            <tr class="border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted">
              <th
                class="h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0">
                Rental ID
              </th>
              <th
                class="h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0">
                Item ID
              </th>
              <th
                class="h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0">
                Location
              </th>
              <th
                class="h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0">
                Status
              </th>
              <th
                class="h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0">
                Checked Out To
              </th>
              <th
                class="h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0">
                Date to Return
              </th>
              <th
                class="h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0"
                id="edit-button">
                More
              </th>
            </tr>
          </thead>
          <tbody class="p-10"></tbody>
          <div class="flex flex-row gap-10 mt-2">
            <!-- Dont know what to do with this, ASK me LATER TBD -->
            <button onclick="makeARental()" class="hidden create-button inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none ring-offset-background bg-primary text-primary-foreground hover:bg-primary/90 h-10 py-2 px-4">
                Create Rental
            </button>
            <!--
            <div class="input-group mb-3">
              <input type="text" class="form-control" style="max-width: 300px;" placeholder="Search..." id="searchInput">
              <div class="input-group-append">
                <button class="btn btn-outline-secondary" type="button" id="searchButton">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search">
                  <circle cx="11" cy="11" r="8"/>
                    <path d="m21 21-4.3-4.3"/>
                  </svg>
                </button>
              </div>
            </div>
            -->
          </div>
        </table>
      </div>

    </section>



    <!-- ========== MAIN CONTENT: STUDENT LIST ==========
     Displays all students in a table:
       - ID, Name, Period, Class Year
       - Selection checkboxes
       - Edit and "More" buttons
       - Action buttons (Add, Generate Barcodes, Delete)
================================================= -->
    <section class="people flex flex-col gap-10" id="people">
      <div class="edit-button w-full bg-white rounded-xl px-7 py-8 mb-2 shadow-md flex flex-row justify-between "
        style="min-width: fit-content;">
        <div class="flex flex-col gap-2 w-full md:w-2/3">
          <h2 class="scroll-m-20 border-b pb-2 text-3xl font-semibold tracking-tight first:mt-0">
            Import Students
          </h2>

          <h1 class="text-xl font-semibold text-blue-600">How to Import Students from TeacherVUE</h1>
          <p class="text-md text-gray-700">Follow these steps:</p>
          <ol class="list-decimal pl-6 text-md text-gray-700 space-y-2">
            <li>Export all students from your classes.</li>
            <li>Make sure the columns are in this order:
              <span class="font-semibold text-pink-500">ID, Name, Period</span>.
            </li>
            <li>Save the file as a <span class="font-semibold text-pink-500">.csv</span>.</li>
          </ol>
          <p class=" text-lg text-gray-700">That's it! You can now import the file into the system by clicking the
            button to the right and uploading it.</p>
        </div>
        <div class="ml-10 my-auto relative w-full md:w-1/3">
          <label for="studentFileUpload" class="create-button inline-flex items-center gap-2 justify-center rounded-2xl text-sm font-medium transition-colors 
    focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-green-600 focus-visible:ring-offset-2 
    disabled:opacity-50 disabled:pointer-events-none ring-offset-background 
    bg-green-600 text-white hover:bg-green-700 h-10 py-4 px-4 cursor-pointer">

    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor" 
        stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus">
        <path d="M5 12h14"/><path d="M12 5v14"/>
    </svg>
    Import Students
    <input type="file" id="studentFileUpload" accept=".csv" class="hidden" />
  </label>
        </div>

      </div>

      <div class="w-full bg-white rounded-xl px-7 py-8 shadow-md" style="min-width: fit-content;">
        <table id="student-table" border="1" class="w-full">
          <div class="w-full flex justify-between">
            <h2 class="scroll-m-20 border-b pb-2 text-3xl font-semibold tracking-tight first:mt-0">
              Student List
            </h2>
            <div class="flex flex-row gap-4 mt-2 edit-button">
              <button onclick="openAddStudentsView()" class="create-button inline-flex items-center gap-2 justify-center rounded-2xl text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none ring-offset-background bg-primary text-primary-foreground hover:bg-primary/90 h-10 py-4 px-4">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus">
        <path d="M5 12h14"/><path d="M12 5v14"/>
    </svg>
                <a>Add Students</a>
            </button>
              <button onclick="generateStudentBarcodes()" class="create-button inline-flex items-center gap-2 justify-center rounded-2xl text-sm font-medium transition-colors  focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none ring-offset-background bg-gray-800 text-white hover:bg-gray-700 h-10 py-4 px-4">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-barcode">
        <path d="M3 5v14"/><path d="M8 5v14"/><path d="M12 5v14"/><path d="M17 5v14"/><path d="M21 5v14"/>
    </svg>
                <a>Generate Student Barcodes</a>
            </button>
              <button onclick="deleteSelectedStudents()" class="create-button inline-flex items-center gap-2 justify-center rounded-2xl text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none ring-offset-background bg-red-600 text-white hover:bg-red-700 h-10 py-4 px-4 edit-button"
           id="deleteSelectedStudentsButton">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash-2">
        <path d="M10 11v6"/><path d="M14 11v6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/><path d="M3 6h18"/><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
    </svg>
                <a>Delete Selected Students</a>
            </button>

              <!--
            <div class="input-group mb-3">
              <input type="text" class="form-control" style="max-width: 300px;" placeholder="Search..." id="searchInput">
              <div class="input-group-append">
                <button class="btn btn-outline-secondary" type="button" id="searchButton">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search">
                    <circle cx="11" cy="11" r="8"/>
                    <path d="m21 21-4.3-4.3"/>
                  </svg>
                </button>
              </div>
            </div>
            -->

            </div>
          </div>





          <thead class="[&_tr]:border-b">

            <tr class="border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted">
              <th
                class="h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0"
                id="items-header-checkboxes">
                Select
              </th>
              <th
                class="h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0">
                ID
              </th>
              <th
                class="h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0">
                Name
              </th>
              <th
                class="h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0">
                Period
              </th>
              <th
                class="h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0">
                Class Year
              </th>
              <th id="edit-button"
                class="h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0">
                More/Edit
              </th>
              <th id="edit-button"
                class=" hidden h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0">
                Edit
              </th>
            </tr>
          </thead>
          <tbody class="p-10"></tbody>

        </table>
      </div>

    </section>
  </main>

  <!-- ========== LOADING OVERLAY ==========
     Full-screen semi-transparent overlay shown during 
     async data loading from server.
========================================= -->
  <div id="loading">
    <!-- Loader icon from https://github.com/n3r4zzurr0/svg-spinners (MIT License) -->
    <img class="report-indicator-loader-icon" alt="loading icon" width="64px" height="64px" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48c3R5bGU+LnNwaW5uZXJfRHVwVXthbmltYXRpb246c3Bpbm5lcl9zTTNEIDEuMnMgaW5maW5pdGV9LnNwaW5uZXJfR1d0WnthbmltYXRpb24tZGVsYXk6LjFzfS5zcGlubmVyX2R3TjZ7YW5pbWF0aW9uLWRlbGF5Oi4yc30uc3Bpbm5lcl80NlFQe2FuaW1hdGlvbi1kZWxheTouM3N9LnNwaW5uZXJfUEQ4MnthbmltYXRpb24tZGVsYXk6LjRzfS5zcGlubmVyX2VVZ2h7YW5pbWF0aW9uLWRlbGF5Oi41c30uc3Bpbm5lcl9lVWFQe2FuaW1hdGlvbi1kZWxheTouNnN9LnNwaW5uZXJfajM4SHthbmltYXRpb24tZGVsYXk6LjdzfS5zcGlubmVyX3RWbVh7YW5pbWF0aW9uLWRlbGF5Oi44c30uc3Bpbm5lcl9EUWhYe2FuaW1hdGlvbi1kZWxheTouOXN9LnNwaW5uZXJfR0lMNHthbmltYXRpb24tZGVsYXk6MXN9LnNwaW5uZXJfbjBZYnthbmltYXRpb24tZGVsYXk6MS4xc31Aa2V5ZnJhbWVzIHNwaW5uZXJfc00zRHswJSw1MCV7YW5pbWF0aW9uLXRpbWluZy1mdW5jdGlvbjpjdWJpYy1iZXppZXIoMCwxLDAsMSk7cjowfTEwJXthbmltYXRpb24tdGltaW5nLWZ1bmN0aW9uOmN1YmljLWJlemllciguNTMsMCwuNjEsLjczKTtyOjJweH19PC9zdHlsZT48Y2lyY2xlIGNsYXNzPSJzcGlubmVyX0R1cFUiIGN4PSIxMiIgY3k9IjMiIHI9IjAiLz48Y2lyY2xlIGNsYXNzPSJzcGlubmVyX0R1cFUgc3Bpbm5lcl9HV3RaIiBjeD0iMTYuNTAiIGN5PSI0LjIxIiByPSIwIi8+PGNpcmNsZSBjbGFzcz0ic3Bpbm5lcl9EdXBVIHNwaW5uZXJfbjBZYiIgY3g9IjcuNTAiIGN5PSI0LjIxIiByPSIwIi8+PGNpcmNsZSBjbGFzcz0ic3Bpbm5lcl9EdXBVIHNwaW5uZXJfZHdONiIgY3g9IjE5Ljc5IiBjeT0iNy41MCIgcj0iMCIvPjxjaXJjbGUgY2xhc3M9InNwaW5uZXJfRHVwVSBzcGlubmVyX0dJTDQiIGN4PSI0LjIxIiBjeT0iNy41MCIgcj0iMCIvPjxjaXJjbGUgY2xhc3M9InNwaW5uZXJfRHVwVSBzcGlubmVyXzQ2UVAiIGN4PSIyMS4wMCIgY3k9IjEyLjAwIiByPSIwIi8+PGNpcmNsZSBjbGFzcz0ic3Bpbm5lcl9EdXBVIHNwaW5uZXJfRFFoWCIgY3g9IjMuMDAiIGN5PSIxMi4wMCIgcj0iMCIvPjxjaXJjbGUgY2xhc3M9InNwaW5uZXJfRHVwVSBzcGlubmVyX1BEODIiIGN4PSIxOS43OSIgY3k9IjE2LjUwIiByPSIwIi8+PGNpcmNsZSBjbGFzcz0ic3Bpbm5lcl9EdXBVIHNwaW5uZXJfdFZtWCIgY3g9IjQuMjEiIGN5PSIxNi41MCIgcj0iMCIvPjxjaXJjbGUgY2xhc3M9InNwaW5uZXJfRHVwVSBzcGlubmVyX2VVZ2giIGN4PSIxNi41MCIgY3k9IjE5Ljc5IiByPSIwIi8+PGNpcmNsZSBjbGFzcz0ic3Bpbm5lcl9EdXBVIHNwaW5uZXJfajM4SCIgY3g9IjcuNTAiIGN5PSIxOS43OSIgcj0iMCIvPjxjaXJjbGUgY2xhc3M9InNwaW5uZXJfRHVwVSBzcGlubmVyX2VVYVAiIGN4PSIxMiIgY3k9IjIxIiByPSIwIi8+PC9zdmc+"></img>
  </div>

  <script type="module">
    import { Canvg } from 'https://cdn.skypack.dev/canvg@4.0.2' //see https://canvg.js.org/examples/browser
    window.canvg = Canvg;
  </script>

  <script>
    function onSuccess(response) {
        alert(JSON.stringify(response));
      }
  </script>
  <script crossorigin src="https://unpkg.com/react@16/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>


  <script>
    tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                },
            },
        }
  </script>

  <!-- ========== SCRIPT IMPORTS ==========
     - canvg: Converts SVG to Canvas for PDF use
     - React & ReactDOM: (Possible future UI use)
     - Tailwind config customization
     - jsPDF & autotable for PDF generation
     - Flowbite, a tailwind component library
======================================= -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.js"></script>

  <!-- ======== ADDED: Script for switching tabs ======== -->
  <script>
    function showSection(id, evt) {
  // Hide all sections
  document.querySelectorAll('#items, #rentals, #people').forEach(sec => {
    sec.style.display = 'none';
  });
  // Show selected section
  document.getElementById(id).style.display = 'block';
  // Update tab button active state
  document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
  evt.target.classList.add('active');
}

// On page load, show Items tab
document.addEventListener('DOMContentLoaded', () => {
  showSection('items', {target: document.querySelector('.tab-btn')});
});
  </script>

  <script>

  </script>

  <!-- ======== END ADDED: Script ======== -->

  <!-- Start of js to remove and insert at runtime-->
  <!-- ========== MAIN JAVASCRIPT LOGIC ==========
     Core functions:
       - refresh(): Loads and renders items, students, rentals from backend
       - generateBarcode(): Creates barcode PNG from data
       - generateBarcodePDF(): Creates and downloads PDF of barcodes
       - getSelectedItems() / getSelectedStudents(): Returns checked rows
       - generateItemBarcodes() / generateStudentBarcodes()
       - deleteSelectedItems() / deleteSelectedStudents()
     Backend Communication:
       - Uses google.script.run.getJSON(...) to fetch data from Google Apps Script backend
============================================= -->
  <script>
    //if the browser console says error at userAppCodePanel:LINE_NUMBER, to find the error take LINE_NUMBER and add the line number of this comment (around 584), this will get you to approximately the line of the error
  
  
  /*Currently broken, see sever part for
  //auto update check
  google.script.run.withSuccessHandler((data) => {
    data = JSON.parse(data);

    const thisVersion = "V8"; //change this before deploying a new version
    var currentVersion = data["currentVersion"];
    console.log(thisVersion)
    console.log(currentVersion)
    console.log(data)
    if (thisVersion != currentVersion) {
      alert("This version of the Inventory System is out of date, please use and bookmark this new url " + data["currentVersionURL"]);
    }
  }).getCurrentVersion();

  */
  

  
  let students = {}
  let items = {}
  let isDisabled = false;

  function createSchoolBadge(schoolName) {
  // Color codes for each school
  const schoolColors = {
    "Corona del Sol": {
      abbreviation: "CDS",
      colors: [
        { name: "Corona Orange", color: "#e67e00" }, // Muted Corona Orange
        { name: "Corona Yellow", color: "#f0c500" }  // Muted Corona Yellow
      ]
    },
    "Desert Vista": {
      abbreviation: "DV",
      colors: [
        { name: "Desert Vista Blue", color: "#4a3c58" }, // Muted Desert Vista Blue
        { name: "Desert Vista Gold", color: "#b98d2a" }  // Muted Desert Vista Gold
      ]
    },
    "Marcos de Niza": {
      abbreviation: "MDN",
      colors: [
        { name: "Marcos de Niza Brown", color: "#8e5b44" }, // Muted Marcos de Niza Brown
        { name: "Marcos de Niza Gold", color: "#d5a700" }  // Muted Marcos de Niza Gold
      ]
    },
    "McClintock": {
      abbreviation: "MC",
      colors: [
        { name: "McClintock Blue", color: "#3a4c78" }, // Muted McClintock Blue
        { name: "McClintock Red", color: "#a55b56" }  // Muted McClintock Red
      ]
    },
    "Mountain Pointe": {
      abbreviation: "MP",
      colors: [
        { name: "Mountain Pointe Maroon", color: "#5b1c1c" }, // Muted Mountain Pointe Maroon
        { name: "Mountain Pointe Gold", color: "#d9a14d" }  // Muted Mountain Pointe Gold
      ]
    },
    "Tempe High": {
      abbreviation: "TH",
      colors: [
        { name: "Tempe High Blue", color: "#3a6071" }, // Muted Tempe High Blue
        { name: "Tempe High White", color: "#FFFFFF" }  // Tempe High White (remains unchanged)
      ]
    }
}


  // Check if the provided school is in the list
  if (!schoolColors[schoolName]) {
    return "";
  }

  // Get the school abbreviation and colors
  const school = schoolColors[schoolName];
  const abbreviation = school.abbreviation;
  const color1 = school.colors[0].color;
  const color2 = school.colors[1].color;

  // Create the HTML badge with two background colors
  return `
    <span style="display: inline-block;
                padding: 5px 10px; color: black; font-weight: bold; border-radius: 12px;">
      ${abbreviation}
    </span>
  `;
}


  function refresh() {

    
    startLoadingAnimation();

    setTimeout(() => {
     //start by clearing the existing tables so the user knows that the data is refreshing
      //items
      let outputTable = document.getElementById("item-table");
      let tbody = outputTable.querySelector("tbody");
      tbody.innerHTML = ``; 

      //students
      outputTable = document.getElementById("student-table");
      tbody = outputTable.querySelector("tbody");
      tbody.innerHTML = ``; 

      //rentals
      outputTable = document.getElementById("rental-table");
      tbody = outputTable.querySelector("tbody");
      tbody.innerHTML = ``; 


      let fullyLoaded = 0;
      
      //render the students and items

      checkedStudents = {} //clear this list which gets populated by rendering students
      google.script.run.withSuccessHandler((data) => {
        students = JSON.parse(data)
        renderStudents(students)
        fullyLoaded++;

        google.script.run.withSuccessHandler((data) => {
          rentals = JSON.parse(data)
          renderRentals(students, rentals)
          fullyLoaded++
        }).getJSON("Rentals");
      }).getJSON("Student");


      checkedItems = {} //clear this list which gets populated by rendering items
      google.script.run.withSuccessHandler((data) => {
        items = JSON.parse(data)
        renderItems(items)
        document.getElementById("close-popup").onclick = function() {
          closeModalDialog();
          
        };
        fullyLoaded++;
      }).getJSON("Items");

      google.script.run.withSuccessHandler((data) => {
        document.getElementById("GoogleSheetsLink").href = data;
        document.getElementById("viewPastRentals").href = data;
      }).getSpreadsheetURL();
      
      


      let a = setInterval(() => {
        if (fullyLoaded >= 3) {
          if (isDisabled) {
            document.querySelectorAll("#edit-button").forEach((button) => button.remove())
            document.querySelectorAll(".edit-button").forEach((button) => button.remove())
          }
          endLoadingAnimation();
          restorePageScroll() //allow scrolling the main page contents again (This might not be necessary anymore 2025-2-25)
          clearInterval(a);
        }
      
      }, 250)
      
      
    }, 250)

    
    
  }

  refresh()

  document.getElementById('studentFileUpload').addEventListener('change', function (event) {
    const file = event.target.files[0];
    if (!file) {
        alert("No file selected.");
        return;
    }

    const reader = new FileReader();

    reader.onload = function (e) {
        const contents = e.target.result;
        const lines = contents.split(/\r?\n/).filter(line => line.trim() !== "");
        var students = [];

        let doesHaveHeader = false;

        for (const line of lines) {
            let [id, name, period] = line.split(',').map(cell => cell.trim());
            if (id.toLowerCase().includes("id") || name.toLowerCase().includes("name") || period.toLowerCase().includes("period")) {
              doesHaveHeader = true;
            }
            if (id.toLowerCase().includes("s")) { // for instance, s26600042
              id = id.substring(1)
            }
            const classYear = "20" + id.substring(0, 2); //s26600042 -> 26

            if (id && name && period) {
                students.push({ id, classYear, period, name });
            }
        }

        if (doesHaveHeader) {
          students = students.filter((val, index) => index !== 0)
        }

        console.log("Parsed students:", students);
        startLoadingAnimation();
        google.script.run.withFailureHandler((err) => {
          alert(`There was a problem in importing the students. Error: ${JSON.stringify(err)}`)
        }).withSuccessHandler((data) => {
          refresh();
        }).addStudentsToDatabase(students);
        // You can now pass `students` to whatever function processes them
        // e.g., addStudentsToSystem(students);
    };

    reader.onerror = function () {
        alert("Failed to read file.");
    };

    reader.readAsText(file);
});

  
  function generateBarcode(data) {
    let barcodeCanvas = document.getElementById("barcodeCanvas")
    //barcodeCanvas = document.getElementById("barcodeCanvas") //have to do this again for some reason or else it's undefined
    JsBarcode(barcodeCanvas, data[1], {
      format: "CODE128",
      width:1,
      height:50,
      displayValue: true,
      text: data[1]
    })

    

    return barcodeCanvas.toDataURL("png", 1) //return a png of the canvas
  }
  function generateBarcodePDF(info) {
  const { jsPDF } = window.jspdf;

  const barcodeWidth = 4.0;  // cm
  const barcodeHeight = 2.4; // cm

  const doc = new jsPDF({ unit: "cm" }); // use cm for easier size control

  let numberOfPages = 1;
  for (let i = 0; i < info.length; i++) {
    // add a page if necessary
    if (i % 7 === 0 && i !== 0) {
      doc.addPage("letter", "portrait");
      doc.setPage(i / 7 + 1);
      numberOfPages++;
    }

    // text label
    doc.text(info[i][0], 1.5, 2.7 + 4 * i - ((numberOfPages - 1) * doc.internal.pageSize.height / 2.54)); 
    // note: converting px/mm if needed

    let barcodeImage = generateBarcode(info[i]);
    if (barcodeImage) {
      doc.addImage(
        barcodeImage,  // image data
        "PNG",         // format
        10,            // x position in cm
        1.5 + 4 * (i % 7), // y position in cm, adjust per barcode
        barcodeWidth,  
        barcodeHeight,
        undefined,     // alias
        "FAST",        // compression
        0              // rotation
      );
    }
  }

  // Save AFTER all pages and barcodes are added
  doc.save(`${dateStringToString(Date.now())}_barcodes.pdf`);
}

  /*Testing
  setTimeout(() => {
    let x = 
    generateBarcodePDF([["1", "abcdefg"], ["2", "123456ab"], ["3", "ap7cnw"], ["4", "a3n8r8t[way0r8way[xwy3p9]]"]])
  }, 5000);
  */

  //a dictionary of items which can be checked (true) or not checked (false), the dictionary will be populated when items are rendered
  let checkedItems = {}
  function getSelectedItems() {

    let output=[]

    Object.entries(checkedItems).forEach((entry) => {
      //entry should be of the form ["ASSET_TAG", boolean]
      //if the item is checked

      if (entry[1]==true) {
        output.push(entry[0])
      }
    })
    return output;
  }
  function generateItemBarcodes() {

    let dataForBarcodes=[]

    let selItems = getSelectedItems();
    if (selItems.length == 0) {
      alert("There are no items to generate barcodes for.")
      return;
    }

    selItems.forEach((item) => {
      dataForBarcodes.push([items[item]["itemDescription"], item]); //add an array containing the item name and asset tag to the info to be turned into barcodes
    })


    console.log(dataForBarcodes)

    generateBarcodePDF(dataForBarcodes)
  }


  function deleteSelectedItems() {

    startLoadingAnimation();

    let selectedItems = getSelectedItems();
    if (selectedItems.length == 0) {
      alert("There is no selected items to delete.")
      endLoadingAnimation();
      return;
    }

    let humanList = ""

    selectedItems.forEach((item) => {
      console.log(item)
      console.log(humanList)
      humanList+= " " + String(item) + ","
    })
    humanList=humanList.slice(0,humanList.length-1) //remove the extra "," at the end of the list/string

    if (confirm("By continuing you will irreversably delete the item(s) '" + humanList + "'")) {
      google.script.run.withSuccessHandler((result) => {
        toast(`${result}`)
        refresh()
      }).deleteItemsFromInventory(selectedItems);
    }
    else {
      alert("canceled")
      endLoadingAnimation();
    }
  }
  function deleteSelectedStudents() {

    startLoadingAnimation();

    let selectedStudents = getSelectedStudents();
    let humanList = ""

    selectedStudents.forEach((student) => {
      console.log(student)
      console.log(humanList)
      humanList+= " " + String(student) + ","
    })
    humanList=humanList.slice(0,humanList.length-1) //remove the extra "," at the end of the list/string

    if (confirm("By continuing you will irreversably delete the student(s) '" + humanList + "'")) {
      google.script.run.withSuccessHandler((result) => {
        toast(`${result}`)
        refresh()
      }).deleteStudentsFromDatabase(selectedStudents);
    }
    else {
      alert("canceled")
      endLoadingAnimation();
    }
  }

  //a dictionary of students which can be checked (true) or not checked (false), the dictionary will be populated when students are rendered
  let checkedStudents = {}

  function getSelectedStudents() {

    let output = [];
    
    Object.entries(checkedStudents).forEach((entry) => {
      //entry should be of the form ["ASSET_TAG", boolean]
      //if the item is checked
      if (entry[1]==true) {
        output.push(entry[0]);
      }
    })

    return output;

  }
  function generateStudentBarcodes() {

    let dataForBarcodes=[]

    getSelectedStudents().forEach((student) => {
      
      dataForBarcodes.push([students[student]["name"], student]); //add an array containing the item name and asset tag to the info to be turned into barcodes
      
    })


    //console.log(dataForBarcodes)

    generateBarcodePDF(dataForBarcodes)
  }
  let addItemRowIDs = []
  function updateAddItemsPopupRows(numberOfItemsToAdd) {
    

    //make load icon visible
    startLoadingAnimation();

  

    if (!numberOfItemsToAdd) {
      numberOfItemsToAdd = document.getElementById("popup-add-items-content-numberOfItemsToAddInput").value;
    }
    

    let table = document.getElementById("popup-add-items-table");
    
    for (let i = 0; i<numberOfItemsToAdd; i++) {
      addItemRowIDs.sort();

      let newID

      if (addItemRowIDs.length > 0) {
        let lastID = Number(addItemRowIDs[addItemRowIDs.length-1].split("popup-add-items-row-")[1])
        newID = `popup-add-items-row-${lastID + 1}`;
      }
      else {
        newID = "popup-add-items-row-1"
      }

      if (addItemRowIDs.length>=20) {
        alert("You can't add more than 20 items at a time");
        break;
      }
      addItemRowIDs.push(newID);
      table.innerHTML += `
      <tr class="border-b overflow-x-auto" id="${newID}" style="max-width: 90%;">
        <td class="max-w-auto" contenteditable="false" id="popup-add-items-deleteRow" onclick="removeAddItemsPopupRow('${newID}')">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
        </td>
        <td class="max-w-auto" contenteditable="false" id="${newID}-roomArea">
          <textarea class="bulk-input-table-textarea" id="${newID}-roomArea-input" onkeyup="resizeTextAreaToFitContent('${newID}-roomArea-input')"></textarea>
        </td>
        <td class="max-w-auto" contenteditable="false" id="${newID}-itemDescription">
          <textarea class="bulk-input-table-textarea" id="${newID}-itemDescription-input" onkeyup="resizeTextAreaToFitContent('${newID}-itemDescription-input')"></textarea>
        </td>
        <td class="max-w-auto" contenteditable="false" id="${newID}-makeModel">
          <textarea class="bulk-input-table-textarea" id="${newID}-makeModel-input" onkeyup="resizeTextAreaToFitContent('${newID}-makeModel-input')"></textarea>
        </td>
        <td class="max-w-auto" contenteditable="false" id="${newID}-assetTagNumber">
          <textarea class="bulk-input-table-textarea" id="${newID}-assetTagNumber-input" onkeyup="resizeTextAreaToFitContent('${newID}-assetTagNumber-input')"></textarea>
        </td>
        <td class="max-w-auto" contenteditable="false" id="${newID}-serialNumber">
          <textarea class="bulk-input-table-textarea" id="${newID}-serialNumber-input" onkeyup="resizeTextAreaToFitContent('${newID}-serialNumber-input')"></textarea>
        </td>
        <td class="max-w-auto" contenteditable="false" id="${newID}-school">
          <select class="bulk-input-table-select" id="${newID}-school-input">
            <option value="">Select School</option>
            <option value="Corona del Sol">Corona del Sol</option>
            <option value="Desert Vista">Desert Vista</option>
            <option value="Marcos de Niza">Marcos de Niza</option>
            <option value="McClintock">McClintock</option>
            <option value="Mountain Pointe">Mountain Pointe</option>
            <option value="Tempe High">Tempe High</option>
          </select>
        </td>

        <td class="max-w-auto" contenteditable="false" id="${newID}-notes">
          <textarea class="bulk-input-table-textarea" id="${newID}-notes-input" onkeyup="resizeTextAreaToFitContent('${newID}-notes-input')"></textarea>
        </td>
      </tr>
      `
    }
    
    document.getElementById("popup-add-items-content-howManyDiv").style.display="none";


    //hide loader icon
    endLoadingAnimation();
  }

  let addStudentsRowIDs = []
  function updateAddStudentsPopupRows(numberOfStudentsToAdd) {


    //make load icon visible
    startLoadingAnimation()

  

    if (!numberOfStudentsToAdd) {
      numberOfStudentsToAdd = document.getElementById("popup-add-students-content-numberOfStudentsToAddInput").value;
    }
    

    let table = document.getElementById("popup-add-students-table");
    
    for (let i = 0; i<numberOfStudentsToAdd; i++) {
      addStudentsRowIDs.sort();

      let newID

      if (addStudentsRowIDs.length > 0) {
        let lastID = Number(addStudentsRowIDs[addStudentsRowIDs.length-1].split("popup-add-students-row-")[1])
        newID = `popup-add-students-row-${lastID + 1}`;
      }
      else {
        newID = "popup-add-students-row-1"
      }

      if (addStudentsRowIDs.length>=20) {
        alert("You can't add more than 20 students at a time");
        break;
      }
      addStudentsRowIDs.push(newID);
      table.innerHTML += `
      <tr class="border-b overflow-x-auto" id="${newID}" style="max-width: 90%;">
        <td class="max-w-auto" contenteditable="false" id="popup-add-students-deleteRow" onclick="removeAddStudentsPopupRow('${newID}')">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
        </td>
        <td class="max-w-auto" contenteditable="false" id="${newID}-studentID">
          <textarea class="bulk-input-table-textarea" id="${newID}-studentID-input" onkeyup="resizeTextAreaToFitContent('${newID}-studentID-input')"></textarea>
        </td>
        <td class="max-w-auto hidden" contenteditable="false" id="${newID}-classYear">
          <textarea class="bulk-input-table-textarea" id="${newID}-classYear-input" onkeyup="resizeTextAreaToFitContent('${newID}-classYear-input')"></textarea>
        </td>
        <td class="max-w-auto" contenteditable="false" id="${newID}-period">
          <textarea class="bulk-input-table-textarea" id="${newID}-period-input" onkeyup="resizeTextAreaToFitContent('${newID}-period-input')"></textarea>
        </td>
        <td class="max-w-auto" contenteditable="false" id="${newID}-name">
          <textarea class="bulk-input-table-textarea" id="${newID}-name-input" onkeyup="resizeTextAreaToFitContent('${newID}-name-input')"></textarea>
        </td>
      </tr>
      `

    }
    
    document.getElementById("popup-add-students-content-howManyDiv").style.display="none";


    //hide loader icon
    endLoadingAnimation();
  }
  function resizeTextAreaToFitContent(id) {
    let textAreaToResize = document.getElementById(id);
    textAreaToResize.style.height = "auto";
    console.log(textAreaToResize.scrollHeight)
    console.log(textAreaToResize.scrollHeight + "px")
    textAreaToResize.style.height = textAreaToResize.scrollHeight + "px";
    console.log(textAreaToResize.style.height)
    
  }
  function removeAddItemsPopupRow(id) {
    document.getElementById(id).remove() //remove the row from the DOM
    addItemRowIDs.splice(addItemRowIDs.indexOf(id), 1); //remove the id of this row from the list
  }
  function saveAddItemsView() {
    let error = false;
    let itemInfo = [];


    //make load icon visible
    startLoadingAnimation();

    console.log(addItemRowIDs)

    //get and verify valid values
    addItemRowIDs.forEach((id) => {
      let assetTagNumberValue = "";
      try {
        assetTagNumberValue = document.getElementById(`${id}-assetTagNumber-input`).value;
      } catch (err) {
      }

      if (assetTagNumberValue == "") {
        assetTagNumber = null;
        document.getElementById(`${id}-assetTagNumber`).style.backgroundColor = "red";
        document.getElementById(`${id}-assetTagNumber-input`).style.backgroundColor = "red";
        document.getElementById(`${id}-assetTagNumber`).style.color = "yellow";
        error = true
      }
      let rowInfo = {
        roomArea: document.getElementById(`${id}-roomArea-input`).value,
        itemDescription: document.getElementById(`${id}-itemDescription-input`).value,
        makeModel: document.getElementById(`${id}-makeModel-input`).value,
        assetTagNumber: document.getElementById(`${id}-assetTagNumber-input`).value,
        serialNumber: document.getElementById(`${id}-serialNumber-input`).value,
        notes: document.getElementById(`${id}-notes-input`).value,
        status: "In",
        school: document.getElementById(`${id}-school-input`).value
      }
      
      console.log(rowInfo.cost)

    

      itemInfo.push(rowInfo);
    });


    //check if the user tried making multiple items with the same id

    let idList = []
    multipleItemsSameId = false;
    itemInfo.forEach((item) => {
      if (idList.includes(item.assetTagNumber)) {
        multipleItemsSameId = true;
      }
      idList.push(item.assetTagNumber)
      
    })
    if (multipleItemsSameId) {
      alert("Error: You can't have multiple items with the same asset tag number. You tried to add multiple items with the asset tag number of '" + idList[idList.length-1] + "'")
      endLoadingAnimation();
    }
    else if (error) {
      alert("error, please correct the highlighted boxes then try again");
      //hide loader icon
      endLoadingAnimation();
    }
    
    else {

      console.log(itemInfo)
      //send the info to the backend for processing
      google.script.run.withSuccessHandler((data) => {
        switch (data) {
          case "success": {



            alert("Successfully made a .pdf with all of the barcode(s). Print these barcodes out and attach them to the items.");

            let dataForBarcodes = []
            itemInfo.forEach((item) => {
             dataForBarcodes.push([item["itemDescription"], item["assetTagNumber"]]); //add an array containing the item name and asset tag to the info  
            })
            generateBarcodePDF(dataForBarcodes)
            
            //clear the table
            document.getElementById("popup-add-items-table").innerHTML = "";

            //close the dialog
            closeModalDialog();

            //update the item list
            refresh();


            addStudentsRowIDs = [] //clear the list so more students can be added
            break;
          }
          default: {

            alert("The server responded with: " + data);

          }


          //hide loader icon
          endLoadingAnimation();
        }
    }).addItemsToDatabase(itemInfo);
    }
    console.log(itemInfo)
  }

  function saveAddStudentsView() {
    let error = false;
    let studentInfo = [];


    //make load icon visible
    startLoadingAnimation();

    //check if there are any students
    if (addStudentsRowIDs.length == 0) {
      alert("Error: You must add at least one student before clicking 'Save Changes'")
      endLoadingAnimation();
      return 1;
    }
    //get and verify valid values
    addStudentsRowIDs.forEach((id) => {

      let studentIDValue = document.getElementById(`${id}-studentID-input`).value;
      let studentID = null;

      if (studentIDValue == "") {
        document.getElementById(`${id}-studentID`).style.backgroundColor = "red";
        document.getElementById(`${id}-studentID-input`).style.backgroundColor = "red";
        document.getElementById(`${id}-studentID`).style.color = "yellow";
        
        error = true;
      }
      else {
        studentID = studentIDValue;

        //undo the highlighting just in case the user corrrected an error in this cell but still has errors in other cells
        document.getElementById(`${id}-studentID`).style.backgroundColor = "white";
        document.getElementById(`${id}-studentID-input`).style.backgroundColor = "white";
        document.getElementById(`${id}-studentID`).style.color = "black";
      }


      let periodValue = document.getElementById(`${id}-period-input`).value;
      let period = null;

      console.log(periodValue)
      if (periodValue == "") {
        period = null;
      }
      else if (Number(periodValue).toString() == "NaN") {
        document.getElementById(`${id}-period`).style.backgroundColor = "red";
        document.getElementById(`${id}-period-input`).style.backgroundColor = "red";
        document.getElementById(`${id}-period`).style.color = "yellow";
        error = true;
      }
      else {
        period = Number(periodValue);

        //undo the highlighting just in case the user corrrected an error in this cell but still has errors in other cells
        document.getElementById(`${id}-period`).style.backgroundColor = "white";
        document.getElementById(`${id}-period-input`).style.backgroundColor = "white";
        document.getElementById(`${id}-period`).style.color = "black";
      }

      let classYearValue = document.getElementById(`${id}-classYear-input`).value;
      let classYear = null;
      console.log("classYear: " + classYearValue);
      console.log(classYearValue)
      if (classYearValue == "") {
        classYear = null;
      }
      else if (Number(classYearValue).toString() == "NaN") {
        document.getElementById(`${id}-classYear`).style.backgroundColor = "red";
        document.getElementById(`${id}-classYear-input`).style.backgroundColor = "red";
        document.getElementById(`${id}-classYear`).style.color = "yellow";
        error = true;
      }
      else {
        classYear = Number(classYearValue);

        //undo the highlighting just in case the user corrrected an error in this cell but still has errors in other cells
        document.getElementById(`${id}-classYear`).style.backgroundColor = "white";
        document.getElementById(`${id}-classYear-input`).style.backgroundColor = "white";
        document.getElementById(`${id}-classYear`).style.color = "black";
      }
      

      let rowInfo = {
        id: studentID,
        classYear: classYear,
        period: period,
        name: document.getElementById(`${id}-name-input`).value
      }
      


      studentInfo.push(rowInfo);
    });

    //check if the user tried making multiple students with the same id
    let idList = []
    multipleStudentsSameId = false;
    studentInfo.forEach((student) => {
      if (idList.includes(student.id)) {
        multipleStudentsSameId = true;
      }
      idList.push(student.id)
      
    })

    
    if (multipleStudentsSameId) {
      alert("Error: You can't have multiple students with the same student ID. You tried to add multiple students with the ID of '" + idList[idList.length-1] + "'")
      endLoadingAnimation();
    }
    else if (error) {
      alert("error, please correct the highlighted boxes then try again");
      //hide loader icon
      endLoadingAnimation();
    }
    else {
      
      console.log(studentInfo)
      //send the info to the backend for processing
      google.script.run.withSuccessHandler((data) => {
        switch (data) {
          case "success": {
            
            //clear the table
            document.getElementById("popup-add-students-table").innerHTML = "";

            //close the dialog
            closeModalDialog();

            //update the student list
            refresh();

            break;
          }
          default: {

            alert("The server responded with: " + data);

          }


          //hide loader icon
          endLoadingAnimation();
        }
    }).addStudentsToDatabase(studentInfo);
    }
    console.log(studentInfo)
  }
  let selectedModalStudentID = ''

  const badSVG = `<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide mx-auto lucide-circle-help">
          <circle cx="12" cy="12" r="10"/>
          <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
          <path d="M12 19h.01"/>
        </svg>`;

  const editSVG = `<svg xmlns="http://www.w3.org/2000/svg" id="edit-button" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-pencil"><path d="M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"/><path d="m15 5 4 4"/></svg>`
  const rentSvg = `
  <svg xmlns="http://www.w3.org/2000/svg" id="edit-button" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-badge-plus mx-auto">
  <path d="M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z"/>
  <line x1="12" x2="12" y1="8" y2="16"/>
  <line x1="8" x2="16" y1="12" y2="12"/>
  </svg>`;

  function saveModalEdits() {

    let currentPageString = document.getElementById("popup-modal-title").innerHTML;

    let popupModal = document.getElementById("popup-modal");
    let table = popupModal.getElementsByTagName("table")[0];
    let tbody = table.getElementsByTagName("tbody")[0];
    let dataToWrite = {}


    switch (currentPageString) {
      case "Item Details":

        dataToWrite = {
          roomArea: document.getElementById("item-details-roomArea").innerText,
          itemDescription: document.getElementById("item-details-description").innerText,
          makeModel: document.getElementById("item-details-makeModel").innerText,
          assetTagNumber: document.getElementById("item-details-assetTag").innerText,
          serialNumber: document.getElementById("item-details-serialNumber").innerText,
          notes: document.getElementById("item-details-notes").innerText
          ,
          status: "In"
          ,
          rentalID: document.getElementById("item-details-rentalID").innerText,
          school: document.getElementById("item-details-school-2").value,

        }

        google.script.run.withSuccessHandler((data) => {
          console.log(data)
          refresh()
        }).editItemsInDatabase(JSON.stringify([dataToWrite]));

        refresh();


        //close the modal
        closeModalDialog();

        break;
      case "Student Details":

        dataToWrite = {
          id: document.getElementById("student-details-id").innerText.toLowerCase().replace("s", ""),
          classYear: "",
          period: Number(document.getElementById("student-details-period").innerText),
          name: document.getElementById("student-details-name").innerText
        }


        //check for invalid values
        

        if (typeof dataToWrite.period != "number") {
          alert("Period must be a number");
          return 1;
        }

        startLoadingAnimation()
        google.script.run.withSuccessHandler((data) => {
          console.log(data)
          refresh()
        }).editStudentsInDatabase(JSON.stringify([dataToWrite]));
        


        //close the modal
        closeModalDialog()
        break;
      case "Add Items View":
        saveAddItemsView();
        break;
      case "Add Students View":
        saveAddStudentsView();
        break;
      case "Rental Details":
        alert("This function has not been implemented yet. If you are trying to fix a rental, please return the rental and create a new one instead through Scanning Mode")
      default:
        //do nothing
        break;
      

    }

  
  }

  // SET ALL SCHOOLS TO A VALUE

  function setallschool() {
    let table = document.getElementById("popup-add-items-table");
    let tr = table.querySelectorAll("tr");

    let school = ""

    tr.forEach((row) => {
      let tds = row.querySelectorAll("td")
      let atVal = tds[tds.length - 2];
      if (school == "") {
        school = atVal.querySelector("select").value
      } else {
        atVal.querySelector("select").value = school
      }
    })
  }

  // DISABLE EDITING

  document.getElementById("enableTeacherAssistantMode").addEventListener("click", function() {
    isDisabled = true;
    openMakeRentalView();
    let elem =  document.getElementById(`scanning-mode-popup`);
    if (elem.requestFullscreen) {
        elem.requestFullscreen();
      } else if (elem.webkitRequestFullscreen) { // Safari
        elem.webkitRequestFullscreen();
      } else if (elem.msRequestFullscreen) { // IE11
        elem.msRequestFullscreen();
      }


    // Disable editing features by setting readonly or disabling inputs/selects, etc.

    /* WAY 1
    
    let tables = ["item-table", "student-table"];
    tables.forEach((table) => {
      let thead = table.querySelector("thead");
    })*/

    //WAY 2
    document.querySelector("#deleteButton").remove();
    document.querySelector("#save-and-close-popup").remove();
    document.querySelectorAll("#edit-button").forEach((button) => button.remove())
    document.querySelectorAll(".edit-button").forEach((button) => button.remove())
    document.querySelectorAll("#taModeBool").forEach((thing) => thing.classList.toggle("hidden"))
  });


  // END DISABLE EDTING

  function closeModalDialog() {

    document.getElementById("deleteButton").style.display="block"; //unhide the delete button (since opening some windows hides it)

    let popupModal = document.getElementById("popup-modal");

    popupModal.classList.add("hidden");

    popupModal.getElementsByTagName("div")[0].scrollIntoView();

    restorePageScroll() //allow scrolling the main page contents again;
  }
  //do we need this function? I made something for this on the backend
  function generateCustomRentalID() {
    const timestamp = Date.now().toString();
    const randomString = Math.random().toString(36).substring(2, 10).toUpperCase();
    let rentalID = '';

    for (let i = 0; i < randomString.length; i++) {
      rentalID += randomString[i] + (timestamp[i] || '');
    }

    return `RNT-${rentalID}`;
  }


  function toast(message) {
    //var x = document.getElementById("snackbar");
    //x.innerText = message;
  }

  function del() {

  }

  //open item details
  function openItemDetails(fullRow) {
    // First undo the base64 encode with atob then parse the string into a js object (the base 64 encoding has to open to deal with item info containing quotes and maybe some other weird characters)
    fullRow = JSON.parse(atob(fullRow));
    fullRow = Object.values(fullRow);
    let curSchool = fullRow[2];
    disablePageScroll();
    startLoadingAnimation()
    google.script.run.withSuccessHandler((data) => {
        fullRow[2] = data
endLoadingAnimation();
        document.getElementById("popup-modal-title").innerHTML = "Item Details";
    document.getElementById("popup-student-details-content").classList.add("hidden");
    document.getElementById("popup-add-items-content").classList.add("hidden");
    document.getElementById("popup-add-students-content").classList.add("hidden");
    document.getElementById("popup-rental-details-content").classList.add("hidden");
    document.getElementById("popup-item-details-content").classList.remove("hidden");

     const popupItemDetailsTable = document.getElementById("popup-item-details-table");
    selectedModalItemID = fullRow[3];

    console.log(JSON.stringify(items, null, 0))
    popupItemDetailsTable.querySelectorAll('tr').forEach(function(row, index) {
      const secondCell = row.children[1];

      if (index === 6) {  // If index is 6, create a dropdown
        const select = document.createElement('select');
        select.classList.add("w-10")
        select.id = "item-details-status-2"
        const options = ['In', 'Out', 'Repair'];

        options.forEach(optionText => {
          const option = document.createElement('option');
          option.value = optionText;
          option.textContent = optionText;
          select.appendChild(option);

        });

        // Set the current value of the dropdown if you have one (for example, if you want to preselect an item state)
        select.selected = fullRow[index] || 'In';  // Default value is 'In' if no value is set

        secondCell.innerHTML = '';  // Clear existing content
        secondCell.appendChild(select);  // Append the dropdown to the cell
      } else if (index === 8) { //select schools
        const select = document.createElement('select');
        select.classList.add("w-20")
        select.id = "item-details-school-2"
        const options = [" ", 'Corona del Sol', 'Desert Vista', 'Marcos de Niza', "McClintock", "Mountain Pointe", "Tempe High"];

        options.forEach(optionText => {
          const option = document.createElement('option');
          option.value = optionText;
          option.textContent = optionText;
          option.selected = curSchool == optionText ? true : false
          select.appendChild(option);

        });

        // Set the current value of the dropdown if you have one (for example, if you want to preselect an item state)
        select.selected = curSchool || '';  // Default value is 'In' if no value is set

        secondCell.innerHTML = '';  // Clear existing content
        secondCell.appendChild(select);  // Append the dropdown to the cell
      } else {
        secondCell.innerText = fullRow[index];
      }
    });

    document.getElementById("popup-modal").classList.remove("hidden");
    toast(JSON.stringify(fullRow));
      }).findMakeModelBasedOnAssetTag(fullRow[3]);

    

    

   

    
  }

  //open item details
  function openRentalDetails(fullRow) {
    
    document.getElementById("deleteButton").style.display="none";
    
    disablePageScroll()

    //first undo the base64 encode with atob then parse the string into a js object (the base 64 encoding has to open to deal with item info containing quotes and maybe some other weird characters)
    fullRow = JSON.parse(atob(fullRow));
    
    document.getElementById("popup-modal-title").innerHTML = "Rental Details";
    document.getElementById("popup-student-details-content").classList.add("hidden");
    document.getElementById("popup-add-items-content").classList.add("hidden")
    document.getElementById("popup-add-students-content").classList.add("hidden")
    document.getElementById("popup-item-details-content").classList.add("hidden")
    document.getElementById("popup-rental-details-content").classList.remove("hidden")

    const popupRentalDetailsTable = document.getElementById("popup-rental-details-table");
    selectedModalRentalID = fullRow[1]

    popupRentalDetailsTable.querySelectorAll('tr').forEach(function(row, index) {
      const secondCell = row.children[1];
      secondCell.innerText = fullRow[index];
    });

    document.getElementById("popup-modal").classList.remove("hidden");
    toast(JSON.stringify(fullRow))

    alert("This function has not been fully implemented yet. You will not be able to save any edits.")
  }

  function openMakeRentalView() {
    document.getElementById("openScanningModeButton").click();

  }

  function openAddItemsView() {
    
    disablePageScroll()

  
    document.getElementById("popup-modal-title").innerHTML = "Add Items View";
    document.getElementById("popup-student-details-content").classList.add("hidden");
    document.getElementById("popup-item-details-content").classList.add("hidden");
    document.getElementById("popup-add-students-content").classList.add("hidden")
    document.getElementById("popup-rental-details-content").classList.add("hidden")
    document.getElementById("popup-add-items-content").classList.remove("hidden")

    document.getElementById("deleteButton").style.display="none";


    document.getElementById("popup-modal").classList.remove("hidden");
  }
  function openAddStudentsView() {
    
    disablePageScroll()

  
    document.getElementById("popup-modal-title").innerHTML = "Add Students View";
    document.getElementById("popup-student-details-content").classList.add("hidden");
    document.getElementById("popup-item-details-content").classList.add("hidden");
    document.getElementById("popup-add-items-content").classList.add("hidden")
    document.getElementById("popup-rental-details-content").classList.add("hidden")
    document.getElementById("popup-add-students-content").classList.remove("hidden")

    document.getElementById("deleteButton").style.display="none";

    document.getElementById("popup-modal").classList.remove("hidden");
  }
  //open student details
  function openStudentDetails(fullRow) {

    disablePageScroll();

    document.getElementById("popup-modal-title").innerHTML = "Student Details";
    document.getElementById("popup-item-details-content").classList.add("hidden");
    document.getElementById("popup-add-items-content").classList.add("hidden")
    document.getElementById("popup-add-students-content").classList.add("hidden")
    document.getElementById("popup-rental-details-content").classList.add("hidden")
    document.getElementById("popup-student-details-content").classList.remove("hidden")

    const popupStudentDetailsTable = document.getElementById("popup-student-details-table");
    selectedModalStudentID = fullRow.id
    popupStudentDetailsTable.querySelectorAll('tr').forEach(function(row, index) {
      const secondCell = row.children[1];
      secondCell.innerText = Object.values(fullRow)[index]
    });

    document.getElementById("popup-modal").classList.remove("hidden");
    toast(JSON.stringify(fullRow))
  }

  // Close popup event
  function makeARental(assetNumber) {
    //btw I just made a function createRental on the backend which takes itemID and studentID and should be callable from the fronend for this
    alert("This function has not been implemented yet. To create a rental, please click on 'Rental Mode' and type in the student and item info.")
    document.getElementById('header').scrollIntoView({ behavior: 'smooth' })
    document.getElementById('openScanningModeButton').classList.add("highlighted");

    setTimeout(() => {
      document.getElementById('openScanningModeButton').classList.remove("highlighted");

    }, 5000)

  }

  //TODO Add confirm dialog
  function handleDelete() {
    let currentPageString = document.getElementById("popup-modal-title").innerHTML;

    

    

    switch (currentPageString) {
      case "Item Details":

        if (confirm("By continuing you will irreversably delete the item '" + selectedModalItemID + "'") == true) {
          startLoadingAnimation();

          //set a timeout before continuing so the loading animation has a chance to start
          setTimeout(() => {
            google.script.run.withSuccessHandler((result) => {
            toast(`${result}`)
            refresh()
            closeModalDialog();
          }).deleteItemFromInventory([selectedModalItemID]);
          }, 250)
          
        } else {
          //do nothing
        }

        break;
      case "Student Details":

        if (confirm("By continuing you will irreversably delete the student '" + selectedModalStudentID + "'") == true) {
          startLoadingAnimation();

          //set a timeout before continuing so the loading animation has a chance to start
          setTimeout(() => {
            google.script.run.withSuccessHandler((result) => {
            toast(`${result}`)
            refresh()
            closeModalDialog();
          }).deleteStudentsFromDatabase([selectedModalStudentID]);
          }, 250)
          
        } else {
          //do nothing
        }
        break;
      case "Add Items View":
        alert("How did you press delete? The delete button should be hidden on this screen. Please email s25600075@stu.tempeunion.org or s26600042@stu.tempeunion.org about this error.")
        break;
      case "Add Students View":
        alert("How did you press delete? The delete button should be hidden on this screen. Please email s25600075@stu.tempeunion.org or s26600042@stu.tempeunion.org about this error.")
        break;
      case "Rental Details":
        alert("How did you press delete? The delete button should be hidden on this screen. Please email s25600075@stu.tempeunion.org or s26600042@stu.tempeunion.org about this error.")
      default:
        //do nothing
        break;
      

    }
  }
    
  function dateStringToString(date) {
    if (new Date(date).getFullYear().toString() == "NaN") {
      return date;
    }
    else if (new Date(date).getFullYear() == 1969 || new Date(date).getFullYear() == 1970) {
      return ""
    }
    else {
      date = new Date(date);

      //if the date is in a normal format
      if (date.getHours() == 0  && date.getMinutes() == 0) {
        return String(date.getMonth() + 1).padStart(2, "0") + "-" + String(date.getDate()).padStart(2, "0") + "-" + String(date.getFullYear()).padStart(4, "0")
      }
      if (date.getHours() == 24) {
        return String(date.getMonth() + 1).padStart(2, "0") + "-" + String(date.getDate()).padStart(2, "0") + "-" + String(date.getFullYear()).padStart(4, "0") + " " + "12" + ":" + String(date.getMinutes()).padStart(2, "0") + "AM"
      }
      else {
        return String(date.getMonth() + 1).padStart(2, "0") + "-" + String(date.getDate()).padStart(2, "0") + "-" + String(date.getFullYear()).padStart(4, "0") + " " + 
        String(date.getHours()<=12 ? date.getHours() : date.getHours() - 12) + ":" + String(date.getMinutes()).padStart(2, "0") + (date.getHours()<12 ? "AM" : "PM")
      }
    }
    
  }
  
  function formatDateStringForDatabase(date) {
    
    if (new Date(date).getFullYear().toString() == "NaN") {
      return date;
    }
    else if (new Date(date).getFullYear() == 1969 || new Date(date).getFullYear() == 1970) {
      return ""
    }
    else {
      
      console.log(date)
      //remove unnessesary zeros, for example 2024-03-02 -> 2024-3-2
      date = date.replace("/", "-")
      date = date.replace("\\", "-")
      date = date.split("-")
      console.log(date)
      dateTemp = [];
      date.forEach( (str) => {
        console.log("a: "+ str)
        dateTemp.push(String(Number(str))) //remove leading zeros
      })
      date = dateTemp;
      console.log("AH: " + date)
      date = date.join("-")

      console.log(date);

      date = new Date(date);

      //if the date is in a normal format
      if (date.getHours() == 0 && date.getMinutes() == 0) {
        return String(date.getFullYear()).padStart(4, "0") + "-" + String(date.getMonth() + 1).padStart(2, "0") + "-" + String(date.getDate()).padStart(2, "0")
      }
      if (date.getHours() == 24) {
        return String(date.getFullYear()).padStart(4, "0") + "-" + String(date.getMonth() + 1).padStart(2, "0")  + "-" + String(date.getDate()).padStart(2, "0") + " " + "12" + ":" + String(date.getMinutes()).padStart(2, "0") + "AM"
      }
      else {
        return String(date.getFullYear()).padStart(4, "0") + "-" + String(date.getMonth() + 1).padStart(2, "0") + "-" + String(date.getDate()).padStart(2, "0") + " " + date.getHours() + ":" + String(date.getMinutes()).padStart(2, "0") + (date.getHours()<12 ? "AM" : "PM")
      }
    }
  }
  function renderItems(items) {

    const outputTable = document.getElementById("item-table");
    const tbody = outputTable.querySelector("tbody");


    //figure out if a smaller version needs to be displayed to fit on screen
    let innerWidth = window.innerWidth;
    let miniVersion = false;
    if (innerWidth < 1250) {
      miniVersion = true;
    }
    /*${row["Status"] === "In" ? `makeARental(${row[3]})` : ''}' 
            ${row[10] === "Out" || row[10] === "Repair" ? 'disabled' : ''}
            style="
              width: 40px;
              height: 40px;
              ${row[10] === "Out" || row[10] === "Repair" ? 'opacity: 0.5; transform: scale(0.9); cursor: not-allowed; pointer-events: none;' : ''"}*/
    
    
    const frontendDataset = Object.values(items).map(row => ({
        room: `${row["roomArea"]}`,
        name: `${row["itemDescription"]}`,
        model: `${row["model"]}`,
        assetTag: `${row["assetTagNumber"]}`,
        status: `${row["status"]}`,
        school: `${row["school"]}`,
        location: `${row["location"]}`,
        rent: `
          <button 
            onclick='makeARental()' class="hidden"
            >
            ${rentSvg}
          </button>`,
        button: `
            <button id="edit-button" onclick='openItemDetails(\`${btoa(JSON.stringify(row))}\`)' style="width: 40px; height: 40px;">
            ${badSVG}
          </button>`
           // Embed full row in button
           ,
        editButton: `
            <button id="edit-button" onclick='openItemDetails(\`${btoa(JSON.stringify(row))}\`)' style="width: 40px; height: 40px;">
            ${editSVG}
          </button>
          `
           // Embed full row in button
    }));

    let rows = []
    
    //document.getElementById("test").innerText = JSON.stringify(frontendDataset).replace(badSVG, "");
    
    let rowClasses = "w-full border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-gray py-14 my-10"
    let cellClasses = "w-max pl-4 p-4 align-middle justify-center items-center [&:has([role=checkbox])]:pr-0 "

    frontendDataset.forEach((rowData) => {
      const row = document.createElement("tr");
    row.className = rowClasses;


    //add this item to the checked item list
    checkedItems[rowData.assetTag] = false;

    let rowHTML = ""

    rowHTML += `<td class="${cellClasses}">
    <input type="checkbox" id="item-checkbox-${rowData.assetTag}" 
           onclick="checkedItems['${rowData.assetTag}'] = !checkedItems['${rowData.assetTag}'];" /></td>`;
    rowHTML += `<td class="${cellClasses}">${rowData.room}</td>`;
    rowHTML += `<td class="${cellClasses}">${rowData.name}</td>`;
    rowHTML += `<td class="${cellClasses}">${createSchoolBadge(rowData.location)}</td>`;
    rowHTML += `<td class="${cellClasses}">${rowData.assetTag}</td>`;
    row.id = rowData.assetTag;

    let statusHTML = ""

    if (rowData["status"] == "In") {
        statusHTML = `<span class="bg-green-500 text-white text-base w-2/3 font-medium text-center px-2.5 py-1 rounded-full inline-block">In</span>`;
    }
    else if (rowData["status"] == "Out") {
      statusHTML = `<span class="bg-red-500 text-white text-base  w-2/3  font-medium text-center px-2.5 py-1 rounded-full inline-block">Out</span>`;
    }
    else if (rowData["status"] == "Repair") {
      statusHTML = `<span class="bg-yellow-500 text-white text-base  w-2/3  font-medium text-center px-2.5 py-1 rounded-full inline-block">Repair</span>`;
    }
    else if (rowData["status"] == "Lost") {
      statusHTML = `<span class="bg-gray-500 text-white text-base w-2/3 font-medium text-center px-2.5 py-1 rounded-full inline-block">Lost</span>`;
    }
  

    rowHTML += `<td class=${cellClasses}>${statusHTML}</td>`
    //rowHTML += `<td class=${cellClasses + " pl-md"}>${rowData["rent"]}</td>`
    rowHTML += `<td class=${cellClasses+ " pl-md"}>${rowData["button"]}</td>`
    //rowHTML += `<td class=${cellClasses+ " pl-md"}>${rowData["editButton"]}</td>`

    row.innerHTML = rowHTML;
    rows.push(row);
    
    })

    

    // Clear existing HTML
    tbody.innerHTML = ``; 

    //add new rows
    rows.forEach((row) => {
      tbody.append(row);
    })
    
  }

 

  function renderStudents(students) {
      console.log(JSON.stringify(students))
      const outputTable = document.getElementById("student-table");
      let tbody = outputTable.querySelector("tbody");
      tbody.innerHTML = ``; 




      for (const [id, student] of Object.entries(students)) {
        //add this student to the checked student list
        checkedStudents[id] = false;

        const row = document.createElement("tr");
        row.className = "border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted"


        const checkbox = document.createElement("td")
        checkbox.className="p-4 align-middle [&:has([role=checkbox])]:pr-0"
        checkbox.innerHTML=`<input type="checkbox" id="item-checkbox-${id}" onclick="checkedStudents['${id}'] = !checkedStudents['${id}'];" />`
        console.log(`<input type="checkbox" id="item-checkbox-${id}" onclick="checkedStudents['${id}'] = !checkedStudents['${id}'];" />`)
        const cellId = document.createElement("td");
        cellId.className = "p-4 align-middle [&:has([role=checkbox])]:pr-0"
        cellId.textContent = student.id;

        const cellName = document.createElement("td");
        cellName.textContent = student.name;
        cellName.className = "p-4 align-middle [&:has([role=checkbox])]:pr-0"

        const cellPeriod = document.createElement("td");
        cellPeriod.textContent = student.period;
        cellPeriod.className = "p-4 align-middle [&:has([role=checkbox])]:pr-0"

        const cellClassYear = document.createElement("td");
        cellClassYear.textContent = student.classYear;
        cellClassYear.className = "p-4 align-middle [&:has([role=checkbox])]:pr-0"

        const email = document.createElement("td");
        email.className = "p-4 align-middle [&:has([role=checkbox])]:pr-0"

        
        const buttonTd = document.createElement("td");
        buttonTd.className = "p-4 align-middle [&:has([role=checkbox])]:pr-0"

        const button = document.createElement("button");
        button.onclick = function() {
          openStudentDetails(student)
        }
        button.style = "width: 40px; height: 40px;"
        button.className = "edit-button"
        button.innerHTML = badSVG;
        
        buttonTd.appendChild(button);

        const editButtonTd = document.createElement("td");
        editButtonTd.className = "p-4 align-middle [&:has([role=checkbox])]:pr-0"

        const editButton = document.createElement("button");
        editButton.onclick = function() {
          openStudentDetails(student)
        }
        editButton.style = "width: 40px; height: 40px;"
        editButton.className = "edit-button"
        editButton.innerHTML = editSVG;
        
        editButtonTd.appendChild(editButton);

        row.appendChild(checkbox);
        row.appendChild(cellId);
        row.appendChild(cellName);
        row.appendChild(cellPeriod);
        row.appendChild(cellClassYear);
        row.appendChild(buttonTd);
        //row.appendChild(editButtonTd);

        tbody.appendChild(row);
      }
    }

    function renderRentals(students, rentals) {
      const outputTable = document.getElementById("rental-table");
      let tbody = outputTable.querySelector("tbody");
      //tbody.innerHTML = ``; 

      console.log("students: ", students)
      console.log("rentals: ", rentals)

       google.script.run.withSuccessHandler((data) => {
        let items = JSON.parse(data)

        for (const [id, rental] of Object.entries(rentals)) {
          if (rental.status == "Returned") {
            continue;
          }
          
          let rentalWithoutDateReturned = {
            rentalID: rental.rentalID,
            itemID: rental.itemID,
            status: rental.status,
            checkedOutTo: rental.checkedOutTo,
            dateCheckedOut: dateStringToString(rental.dateCheckedOut),
            dateExpectedReturned: dateStringToString(rental.dateExpectedReturned),
            notes: rental.notes,
          }

          let findItemStatus = Object.values(items).filter((item) => item.assetTagNumber === rental.itemID);
          let school = "N/A"
          if (findItemStatus.length > 0) {
            // The item has been found
            let item = findItemStatus[0]; // You can access the first match, if there are multiple
            school = item.school;
            console.log(item);
          } else {
            // Item not found
            console.log("Item not found.");
          }

          let expectedReturnDate = new Date(rental.dateExpectedReturned);
            let today = new Date();
            let diffTime = expectedReturnDate - today; // Difference in milliseconds
            let diffDays = Math.ceil(diffTime / (1000 * 3600 * 24)); // Convert to days



          tbody.innerHTML += `
          <tr class="border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted" id="EX1">
            <td class="p-4" align-middle="" [&:has([role="checkbox])]:pr-0">${rental.rentalID}</td>
            <td class="p-4" align-middle="" [&:has([role="checkbox])]:pr-0">${rental.itemID}</td>
            <td class="p-4" align-middle="" [&:has([role="checkbox])]:pr-0">${createSchoolBadge(school)}</td>
            <td class="p-4" align-middle="" [&:has([role="checkbox])]:pr-0">${rental.status}</td>
            <td class="p-4" align-middle="" [&:has([role="checkbox])]:pr-0">${students[rental.checkedOutTo]["name"]}</td>
            <td class="p-4" align-middle="" [&:has([role="checkbox])]:pr-0" style="color: ${diffDays < 0 ? 'red' : 'inherit'};">
             ${dateStringToString(rental.dateExpectedReturned)} - (${diffDays} day${diffDays != 1 ? "s" : ""}) ${diffDays < 0 ? "- OVERDUE" : ""}
            </td>
            <td class="p-4" align-middle="" [&:has([role="checkbox])]:pr-0">
              <button class="edit-button" id="edit-button" onclick="openRentalDetails('${btoa(JSON.stringify(Object.values(rentalWithoutDateReturned)))}')" style="width: 40px; height: 40px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"  class="lucide mx-auto lucide-circle-help">
                  <circle cx="12" cy="12" r="10"></circle>
                  <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                  <path d="M12 19h.01"></path>
                </svg>
              </button>
            </td>
          </tr>`


      }
      }).getJSON("Items");

    
      
    }


  function openScanningMode() {
    disablePageScroll();

    document.getElementById(`scanning-mode-popup`).classList.remove(`hidden`);
    let scanningModeInputBox = document.getElementById(`scanning-mode-input-box`);

    let gottenTableS = document.getElementById("student-table");

    let elementBody = gottenTableS.querySelector("tbody");
    let elementRows = elementBody.querySelectorAll("tr");


    elementRows.forEach((row) => {
      
    })

    scanningModeInputBox.focus();
    scanningModeInputBox.select();

    scanningModeInputBox.removeEventListener("keypress", processScanningModeKeyUp) //to remove any previous event listner
    scanningModeInputBox.addEventListener("keypress", processScanningModeKeyUp)


    //if the user presses enter in the input box, then submit the code
    /*Modified from https://www.w3schools.com/howto/howto_js_trigger_button_enter.asp */
    scanningModeInputBox.addEventListener("keypress", function(event) {
    
    console.log("event.key: " + event.key)
    // If the user presses the "Enter" key on the keyboard
    if (event.key == "Enter") {
      // Cancel the default action, if needed
      event.preventDefault();
      // Trigger the button element with a click
      document.getElementById("submit-scanning-mode-popup").click();
    }
  }); 

    //auto scroll to the top
    var scanningModePopup = document.getElementById("scanning-mode-popup")
    scanningModePopup.scrollTo(0,0);
  }

  function openReportsView() {

    disablePageScroll()

    document.getElementById(`reports-view-popup`).classList.remove(`hidden`);
  }

  var previousTime = Date.now()
  var numberOfConsecutiveQuickKeysPresses = 0

  function processScanningModeKeyUp() {
    let currentTime = Date.now()
    

    console.log(currentTime - previousTime)

    //if a user types two characters within 50ms of eachother update the quick key press counter
    if (currentTime - previousTime < 70) {
      numberOfConsecutiveQuickKeysPresses++
      console.log("incrementing key counter")
    }
    //otherwise reset the consecutive counter
    else {
      numberOfConsecutiveQuickKeysPresses = 0;
      console.log("resetting key statistics")
    }


    //if there are 5 or more quick consecutive key presses, a human probably isn't typing (since a real user probably wouldn't do that unless they were just spamming random keys), set a timout to check if this is the end of a barcode scanner typed string
    if (numberOfConsecutiveQuickKeysPresses >= 5) {
    
      //call a function in 300ms to try submitting the form if the barcode scanner is done typing
      setTimeout(() => {
        //if there hasn't been another key pressed since this timeout started
        if (Date.now() - previousTime >= 300) {
          //submit the form
          submitScanningMode()
        }
      }, 300);
      
      console.log("not a human typing")
    }


    previousTime= currentTime;
  }


  let scanningModeCodes = []
  async function submitScanningMode() {
    
    console.log("submitting form")
    let scanningModeInputBox = document.getElementById(`scanning-mode-input-box`);
    console.log(scanningModeInputBox.value);

    //if there is no input, just return
    let input = scanningModeInputBox.value
    scanningModeInputBox.value = ""; //clear the input box for the next code
    if (input == "") {
      console.log("Empty input, aborting submit")
      return
    }

    

    scanningModeCodes.push(input); //add the input's value to the list of scanned codes
    let scanningModeCodesTemp = Array.from(scanningModeCodes); //move the codes into a temp list and clear the original so more codes can be rapidly entered
    scanningModeInputBox.focus()
    scanningModeInputBox.select() //select and focus the box again for more input

    //output a message that the code was recieved sucesfully
    if (scanningModeCodesTemp.length == 1) {
      document.getElementById("scanning-mode-message").innerText = "First code sucessfully input, please enter the next code"
      document.getElementById("scanning-mode-message").style.display = "block";
    }
    else if (scanningModeCodesTemp.length == 2) {
      document.getElementById("scanning-mode-message").innerText = "Second code input sucesfully, processing now"
      document.getElementById("scanning-mode-message").style.display = "block";
    }
    
    //check if the code list is full
    if (scanningModeCodesTemp.length >= 2) {
      scanningModeCodes = []; //reset the code list
      
      scanningMode = document.getElementById("scanning-mode-selection-div").getAttribute("selection"); 

      //make the loading icon visible
      startLoadingAnimation();
     
      //check the type of each code

      //get the type of code 1
      let code1Type = getCodeType(scanningModeCodesTemp[0])


      //get the type of code 2
      let code2Type = getCodeType(scanningModeCodesTemp[1])

      //once that is done, make sure there are no errors and try to create a new rental
      console.log("code1Type: " + code1Type);
      console.log("code2Type: " + code2Type);


      switch (code1Type)
      {
        case "notInDatabase":
          scanningModeFlashAndReset("error", scanningModeCodesTemp[0] + " is not in the database") //flash the screen red for a second to indicate failure then reset for more codes

          return 1
          break;
        case "error: both a student and an item are registered with this code/id":
          scanningModeFlashAndReset("error", "error: both a student and an item are registered under " + scanningModeCodesTemp[0]) //flash the screen red for a second to indicate failure then reset for more code
          return 2
          break;
        default:
          break;
      }
      switch (code2Type)
      {
        case "notInDatabase":
          scanningModeFlashAndReset("error", scanningModeCodesTemp[1] + " is not in the database") //flash the screen red for a second to indicate failure then reset for more codes
          
          return 3
          break;
        case "error: both a student and an item are registered with this code/id":
          scanningModeFlashAndReset("error", "error: both a student and an item are registered under " + scanningModeCodesTemp[1]) //flash the screen red for a second to indicate failure then reset for more codes
          
          return 4
          break;
        default:
          break;
      }


      if (code1Type == code2Type) {
          scanningModeFlashAndReset("error", "error: both barcodes are registered as type '" + code1Type + "'") //flash the screen red for a second to indicate failure then reset for more codes
          return 5
      }


      let studentCode = null
      let itemCode = null

      if (code1Type == "student") {
        studentCode = scanningModeCodesTemp[0]
        itemCode = scanningModeCodesTemp[1]
      }
      else if (code1Type == "item") {
        studentCode = scanningModeCodesTemp[1]
        itemCode = scanningModeCodesTemp[0]
      }
      else {
        scanningModeFlashAndReset("error", "error 1 in index.html") //flash the screen red for a second to indicate failure then reset for more codes
        return 100
      }

      console.log("Student: " + studentCode + "     Item: " + itemCode )



      //if there is a valid student code and item code, check the scanning mode
      if (studentCode && itemCode) {
        
        //if the scanning mode is create, try to create a rental
        if (scanningMode == "create") {
           let dateIntendedToRet = prompt("What date would you like this rental to be returned? Use XX/XX/XXXX (eg. 06/12/2025)")

            google.script.run.withSuccessHandler((data) => {

            //handle different possible responses
            switch (data) {
              case "Can't create new rental, the student ID specified is not in the database":
                scanningModeFlashAndReset("error", "Can't create new rental, the student ID '" + studentCode + "' is not in the database") //flash the screen red for a second to indicate failure then reset for more codes
                return 6;
                break;
              case "Can't create new rental, the item has a status of 'Out'":
                scanningModeFlashAndReset("error", "Can't create new rental, the item already has a status of '" + items[itemCode]["status"] + "'") //flash the screen red for a second to indicate failure then reset for more codes
                break;
                return 7
              case "Can't create new rental, the item has a status of 'Repair'":
                scanningModeFlashAndReset("error", "Can't create new rental, the item has a status of 'repair'") //flash the screen red for a second to indicate failure then reset for more codes
                break;
                return 7
              case "success":
                console.log("succeded in creating new rental for student '" + studentCode + "' and item '" + itemCode + "'")
                scanningModeFlashAndReset("success") //flash the screen green for a second to indicate sucess then reset for more codes
              
            }

          }).createRental(studentCode, itemCode, dateIntendedToRet);

        }
        //if the scanning mode is return then try to return the item
        else if (scanningMode == "return") {
          //try to return the item
            google.script.run.withSuccessHandler((data2) => {
              if (data2 == "success") {
                scanningModeFlashAndReset("success") //flash the screen green for a second to indicate sucess then reset for more codes
              }
              else if (data2 == "failed, no outstanding rental with the information specified found") 
              {
                scanningModeFlashAndReset("error", "failed, no outstanding rental with the information specified found") //flash the screen red for a second to indicate failure then reset for more codes
                return 8;
              }

              else {
                scanningModeFlashAndReset("error", "Error returning rental: error message from server was '" + data2 + "'") //flash the screen red for a second to indicate failure then reset for more codes
                return 9;
            }
            }).returnRentals([itemCode], studentCode);
        }
      }
        




      refresh() //get an updated copy of the student and item lists
      

    }
  }

  function scanningModeFlashAndReset(type, errorMessage=null) {
    let color = "#FFFFFF"
    if (type == "error") {
      color = "#fb3e33"
    }
    else if (type == "success") {
      color = "#5dfb91"
    }
    //make the loading icon hidden again
    endLoadingAnimation();

    let scanningModePopup = document.getElementById("scanning-mode-popup");

    let elementToFlash = scanningModePopup.getElementsByTagName("div")[0];

    elementToFlash.style.backgroundColor = color;
    elementToFlash.classList.remove("bg-white")


    if (errorMessage) {
      document.getElementById("scanning-mode-message").innerText = errorMessage
      document.getElementById("scanning-mode-message").style.display = "block";
      
      //display an alert with the rror message so the user has to acknowledge the eror, use a slight delay so the page color can change first
      setTimeout(() => {
        alert(errorMessage);
      }, 25)
    }
    else {
      document.getElementById("scanning-mode-message").innerText = ""
      document.getElementById("scanning-mode-message").style.display = "none";
    }
    
    setTimeout(() => {
      elementToFlash.style.backgroundColor = "white";
      elementToFlash.classList.add("bg-white")
      
    }, 3000)
  }
  function getCodeType(code) {
    console.log("Checking what type this code is '" + code + "'")
    let itemsKeys = Object.keys(items);
    let studentsKeys = Object.keys(students);

    let isItem = false;
    let isStudent = false;
    if (itemsKeys.indexOf(code) != -1) {
      isItem = true;
    }
    if (studentsKeys.indexOf(code) != -1) {
      isStudent = true;
    }
    if (!isItem && !isStudent) {
      return "notInDatabase";
    }

    if (isItem && isStudent) {
      return "error: both a student and an item are registered with this code/id"
    }

    if (isItem) {
      return "item"
    }
    else {
      if (isStudent) {
        return "student";
      }
    }
  }
  function closeScanningMode() {
    document.getElementById(`scanning-mode-popup`).classList.add(`hidden`);

    scanningModeInputBox.removeEventListener("keypress", processScanningModeKeyUp);

    refresh()
  }
  function closeReportsView() {
    document.getElementById(`reports-view-popup`).classList.add(`hidden`);
    restorePageScroll();
  }

  function scanningModeSelectMode(mode) {

    if (mode == "create") {
      document.getElementById("scanning-mode-selection-div").setAttribute("selection", "create");
    }
    else if (mode == "return") {
      document.getElementById("scanning-mode-selection-div").setAttribute("selection", "return");
    }

    //reselect the input text box
    let scanningModeInputBox = document.getElementById(`scanning-mode-input-box`);

    scanningModeInputBox.focus();
    scanningModeInputBox.select();
  }


  let reportsBeingGenerated = []
  function generateAndDownloadReport(reportType, timespanStart, timespanEnd) {


    //Some documentation on pdf-autotable (https://www.jsdocs.io/package/jspdf-autotable#UserOptions)

    let startDate = new Date(timespanStart);
    let endDate = new Date(timespanEnd);

    if (reportsBeingGenerated.includes(reportType)) {
      alert("already generating a report of type '" + reportType + "'");
    }
    else {
      reportsBeingGenerated.push(reportType);

      let generatingReportsIndicator = document.getElementById("generatingReportsIndicator");


      let userReportTitle = ""
      switch (reportType) {
        case "itemPopularityUsageReport": 
          userReportTitle = "Item Popularity/Usage Report";
          break;
        case "lostItemReport":
          userReportTitle = "Lost Item Report";
          break;
        
      }

      //add an indicator to the generatingReportsIndicator
      generatingReportsIndicator.innerHTML += `
      <div id="indicator-${reportType}" style="display: flex; flex-direction: row">
        <h3 class="report-indicator-header">${userReportTitle}</h3>
      </div>
      `
      generatingReportsIndicator.style.visibility = "visible";

      google.script.run.withSuccessHandler((data) => {
      

      if (data=="The server encountered an error while generating a lost item report") {
        alert(data);
      }
      else {

        data = JSON.parse(data);

        const { jsPDF } = window.jspdf;
        //const { autoTable } = window.autoTable;

        const doc = new jsPDF();       


        //add a the report title
        doc.text(15, 10, userReportTitle);


        //let wrappedText = doc.splitTextToSize(JSON.stringify(data), 200)
        //doc.text(wrappedText, 5, 5);  

        console.log(data)
        // Or use javascript directly:
        
        doc.autoTable(data)

        doc.save(timespanStart.replace("-", "_") + "-" + timespanEnd.replace("-", "_") + "-" + reportType + ".pdf");


        //update the indicator
        let tempArray = []
        reportsBeingGenerated.forEach((report) => {
          if (report != reportType) {
            tempArray.push(report);
          }
        })
        reportsBeingGenerated = tempArray;

        if (reportsBeingGenerated.length == 0) {
          generatingReportsIndicator.style.visibility = "hidden";
        }
        else {
          generatingReportsIndicator.style.visibility = "visible";
        }
      }
      


      //remove the generating indicator
      document.getElementById(`indicator-${reportType}`).remove();
     
    }).generateReport(reportType, timespanStart, timespanEnd);
    }
    
  }


  function viewPastRentals() {
    google.script.run.withSuccessHandler((data) => {
      alert(data);
    }).getSpreadsheetURL();

  }

  function disablePageScroll() {
    document.getElementsByTagName("html")[0].style.maxHeight = "100vh";
    document.getElementsByTagName("html")[0].style.overflowY = "hidden";
  }
  function restorePageScroll() {
    document.getElementsByTagName("html")[0].style.removeProperty("max-height");
    document.getElementsByTagName("html")[0].style.removeProperty("overflow-y");
  }

  scanningModeInputBox = document.getElementById("scanning-mode-input-box");

  
  //I don't think these lines actually ended up doing anything, I fixed the problem I was setting this up for using the weird workaround in doGet() in Code.gs
  //# sourceURL=indexJS
  //# sourceMappingURL = indexJS

  //rerender the items table when the page changes size (to try to stop it from overflowing)
  let windowWidth = window.innerWidth;
  window.onresize = function() {
    //if the window was greater or less than 1250px and has changed to the other side of 1250px then rerender the items table
    if (window.innerWidth < 1250 && windowWidth > 1250) {
      refresh();
    }
    if (window.innerWidth > 1250 && windowWidth < 1250) {
      refresh();
    }
    windowWidth = window.innerWidth;
  }



  function startLoadingAnimation() {
    document.getElementById("loading").style.visibility = "visible";
    disablePageScroll();
    
  }
  function endLoadingAnimation() {
    document.getElementById("loading").style.visibility = "hidden";
    restorePageScroll();
  }
  </script>
  <!-- End of js to remove and insert at runtime-->


</body>


</html>
